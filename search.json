[
  {
    "objectID": "technical_blog.html",
    "href": "technical_blog.html",
    "title": "Technical Blog",
    "section": "",
    "text": "Don’t RAG on Knowledge Graphs(Or Do) Benchmarking: Theory behind using an LLM to Build Knowledge Graphs – Part One\n\n\n\n\n\n\nknowledge-graphs\n\n\nrag\n\n\nbenchmarking\n\n\n\nGoing into the nitty gritty (theoretical) details and nuances of building knowledge graphs with Large Language Models\n\n\n\n\n\nApr 12, 2024\n\n\nDmitriy Leybel\n\n\n\n\n\n\n\n\n\n\n\n\nDon’t RAG on Knowledge Graphs(Or Do): RAG, Knowledge Graphs, and Benchmarks – Part Zero\n\n\n\n\n\n\nknowledge-graphs\n\n\nrag\n\n\nbenchmarking\n\n\n\nFoundational preamble to the benchmarking of knowledge graph-centric RAG flows\n\n\n\n\n\nApr 5, 2024\n\n\nDmitriy Leybel\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-1/index.html",
    "href": "technical_blog/knowledge-graph-rag-benchmark-1/index.html",
    "title": "Don’t RAG on Knowledge Graphs(Or Do) Benchmarking: Theory behind using an LLM to Build Knowledge Graphs – Part One",
    "section": "",
    "text": "On the last episode of: Don’t RAG on Knowledge Graphs(Or Do): RAG, Knowledge Graphs, and Benchmarks – Part Zero:"
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-1/index.html#data-and-prediction-datasets",
    "href": "technical_blog/knowledge-graph-rag-benchmark-1/index.html#data-and-prediction-datasets",
    "title": "Don’t RAG on Knowledge Graphs(Or Do) Benchmarking: Theory behind using an LLM to Build Knowledge Graphs – Part One",
    "section": "1.1 Data and Prediction Datasets",
    "text": "1.1 Data and Prediction Datasets\n\n\n\n\n\n\nBy ‘predictions’, we mean ‘the answers’ and any other expected outputs. It’s a vestige of machine learning vernacular.\n\n\n\n\n\n\nFortunately for us, the fine folks who’ve created the MuSiQue benchmark have made it simple. They’ve ran several models on the dataset and used them for evaluations. We can find the generated predictions in their github repo; this will give us the starting point we need. Lets first look at an example of the input, provided in the data folder(again, from the repo). Note that there is a question, an answer, an answerable flag and a bunch of paragraphs marked whether they support the answer.\n\n\n\n\nCode\nwith jsonlines.open(musique_dir + '/data/musique_full_v1.0_train.jsonl') as reader:\n    lines = [reader.read() for _ in range(1000)]\ndisplay(Markdown('**Line Example**'), pprint(lines[1]))\n\n\n{'answer': 'north',\n 'answer_aliases': ['North', 'N'],\n 'answerable': True,\n 'id': '2hop__269805_135710',\n 'paragraphs': [{'idx': 0,\n                 'is_supporting': False,\n                 'paragraph_text': 'Milton F. Pavlic (1909–1942) was a United '\n                                   'States Navy officer killed in action '\n                                   'during World War II for whom a U.S. Navy '\n                                   'high-speed transport was named.',\n                 'title': 'Milton F. Pavlic'},\n                {'idx': 1,\n                 'is_supporting': False,\n                 'paragraph_text': 'Osmund Holm-Hansen (also known as Oz '\n                                   'Holm-Hansen) is a Norwegian-born American '\n                                   'scientist, for whom Mount Holm-Hansen, in '\n                                   'Antarctica is named. A plant physiologist '\n                                   'by training, from 1962 Holm-Hansen was the '\n                                   'head of polar research at the Scripps '\n                                   'Institution of Oceanography.',\n                 'title': 'Osmund Holm-Hansen'},\n                {'idx': 2,\n                 'is_supporting': False,\n                 'paragraph_text': '\"Sapphire Princess\" was built in Japan by '\n                                   'Mitsubishi Heavy Industries, the second '\n                                   'Princess Cruises ship to be built in a '\n                                   'Japanese shipyard. Her only sister ship is '\n                                   '\"Diamond Princess\", with whom she swapped '\n                                   'names during construction.',\n                 'title': 'Sapphire Princess'},\n                {'idx': 3,\n                 'is_supporting': False,\n                 'paragraph_text': 'Lake Pontchartrain is named for Louis '\n                                   'Phélypeaux, comte de Pontchartrain. He was '\n                                   'the French Minister of the Marine, '\n                                   'Chancellor, and Controller-General of '\n                                   \"Finances during the reign of France's \"\n                                   '\"Sun King\", Louis XIV, for whom the colony '\n                                   'of \"La Louisiane\" was named.',\n                 'title': 'Lake Pontchartrain'},\n                {'idx': 4,\n                 'is_supporting': False,\n                 'paragraph_text': 'Henry Crater is a large crater in the '\n                                   'Arabia quadrangle of Mars, located at '\n                                   '10.9° north latitude and 23.3° east '\n                                   'longitude. It is in diameter and was named '\n                                   'after the brothers Paul Henry and Prosper '\n                                   'Henry, both of whom were French telescope '\n                                   'makers and astronomers.',\n                 'title': 'Henry (Martian crater)'},\n                {'idx': 5,\n                 'is_supporting': False,\n                 'paragraph_text': 'Where Dead Voices Gather is a book by Nick '\n                                   'Tosches. It is, in part, a biography of '\n                                   'Emmett Miller, one of the last minstrel '\n                                   'singers. Just as importantly, it depicts '\n                                   \"Tosches' search for information about \"\n                                   'Miller, about whom he initially wrote in '\n                                   'his book \"Country: The Twisted Roots of '\n                                   'Rock and Roll\". It is also a study of '\n                                   'minstrelsy and its connection to American '\n                                   'folk music, country music, the blues and '\n                                   'ultimately, rock and roll. In that way, it '\n                                   'is a companion volume to his other books '\n                                   'of music journalism, \"Country\" and \"Unsung '\n                                   'Heroes of Rock N\\' Roll\".',\n                 'title': 'Where Dead Voices Gather'},\n                {'idx': 6,\n                 'is_supporting': True,\n                 'paragraph_text': 'Norway has a total area of and a '\n                                   'population of 5,312,300 (as of August '\n                                   '2018). The country shares a long eastern '\n                                   'border with Sweden (1,619 km or 1,006\\xa0'\n                                   'mi long). Norway is bordered by Finland '\n                                   'and Russia to the north-east, and the '\n                                   'Skagerrak strait to the south, with '\n                                   'Denmark on the other side. Norway has an '\n                                   'extensive coastline, facing the North '\n                                   'Atlantic Ocean and the Barents Sea. The '\n                                   \"maritime influence also dominates Norway's \"\n                                   'climate with mild lowland temperatures on '\n                                   'the sea coasts, whereas the interior, '\n                                   'while colder, also is a lot milder than '\n                                   'areas elsewhere in the world on such '\n                                   'northerly latitudes. Even during polar '\n                                   'night in the north, temperatures above '\n                                   'freezing are commonplace on the coastline. '\n                                   'The maritime influence brings high '\n                                   'rainfall and snowfall to some areas of the '\n                                   'country.',\n                 'title': 'Norway'},\n                {'idx': 7,\n                 'is_supporting': False,\n                 'paragraph_text': 'The Hireling Shepherd (1851) is a painting '\n                                   'by the Pre-Raphaelite artist William '\n                                   'Holman Hunt. It represents a shepherd '\n                                   'neglecting his flock in favour of an '\n                                   'attractive country girl to whom he shows a '\n                                   \"death's-head hawkmoth. The meaning of the \"\n                                   'image has been much debated.',\n                 'title': 'The Hireling Shepherd'},\n                {'idx': 8,\n                 'is_supporting': False,\n                 'paragraph_text': 'Naissa Mosque is a mosque in Qardaha, '\n                                   'along the Syrian coast. It was built in '\n                                   '1989 by architect Abdul Rahman Naassan, '\n                                   'and funded by the mother of former '\n                                   'president Hafez al-Assad, Naissa '\n                                   'Assad—after whom the mosque was named. The '\n                                   'state funeral of Hafez al-Assad was '\n                                   'observed at the mosque.',\n                 'title': 'Naissa Mosque'},\n                {'idx': 9,\n                 'is_supporting': False,\n                 'paragraph_text': 'The quick German victory over the French '\n                                   'stunned neutral observers, many of whom '\n                                   'had expected a French victory and most of '\n                                   'whom had expected a long war. The '\n                                   'strategic advantages possessed by the '\n                                   'Germans were not appreciated outside '\n                                   'Germany until after hostilities had '\n                                   'ceased. Other countries quickly discerned '\n                                   'the advantages given to the Germans by '\n                                   'their military system, and adopted many of '\n                                   'their innovations, particularly the '\n                                   'General Staff, universal conscription and '\n                                   'highly detailed mobilization systems.',\n                 'title': 'Franco-Prussian War'},\n                {'idx': 10,\n                 'is_supporting': True,\n                 'paragraph_text': 'Tveitsund is a village in Nissedal '\n                                   'municipality, Norway. The urban area '\n                                   'Tveitsund, which consists of Tveitsund and '\n                                   'Treungen, has a population of 361.',\n                 'title': 'Tveitsund'},\n                {'idx': 11,\n                 'is_supporting': False,\n                 'paragraph_text': 'John Francis Sheehan (1910–1942) was a '\n                                   'United States Navy sailor killed in action '\n                                   'during World War II for whom a destroyer '\n                                   'escort was named during the war.',\n                 'title': 'John Francis Sheehan'},\n                {'idx': 12,\n                 'is_supporting': False,\n                 'paragraph_text': 'Holmes Summit is a peak rising to , the '\n                                   'highest elevation in the Read Mountains of '\n                                   'the Shackleton Range in Antarctica. It was '\n                                   'photographed from the air by the U.S. Navy '\n                                   'in 1967 and was surveyed by the British '\n                                   'Antarctic Survey in the period 1968–71. In '\n                                   'association with the names of geologists '\n                                   'grouped in this area, it was named by the '\n                                   'UK Antarctic Place-Names Committee in 1971 '\n                                   'after Professor Arthur Holmes, after whom '\n                                   'the Holmes Hills in Palmer Land were also '\n                                   'named.',\n                 'title': 'Holmes Summit'},\n                {'idx': 13,\n                 'is_supporting': False,\n                 'paragraph_text': ', better known by her pen name is a '\n                                   'Japanese manga artist. She is married to '\n                                   'fellow manga artist Tatsuneko, from whom '\n                                   'he took the name of . She is a graduate of '\n                                   'Mita Senior High School, Tokyo. She '\n                                   'currently lives in Setagaya, Tokyo with '\n                                   'her husband and daughter.',\n                 'title': 'Yun Kōga'},\n                {'idx': 14,\n                 'is_supporting': False,\n                 'paragraph_text': 'The Book of Proper Names () is a Belgian '\n                                   'novel by Amélie Nothomb. It was first '\n                                   'published in 2002. It is a romanticized '\n                                   'account of the life of the singer RoBERT, '\n                                   'whom Nothomb became acquainted with as an '\n                                   'avid admirer of her songs.',\n                 'title': 'The Book of Proper Names'},\n                {'idx': 15,\n                 'is_supporting': False,\n                 'paragraph_text': '653 Berenike is a main-belt asteroid '\n                                   'discovered on November 27, 1907, by Joel '\n                                   'Hastings Metcalf at Taunton, '\n                                   'Massachusetts. It is named after Berenice '\n                                   'II of Egypt, after whom the constellation '\n                                   'Coma Berenices is also named.',\n                 'title': '653 Berenike'},\n                {'idx': 16,\n                 'is_supporting': False,\n                 'paragraph_text': 'orbiting the Sun. It was discovered on 21 '\n                                   'February 1906 by August Kopff from '\n                                   'Heidelberg. Kopff named the asteroid after '\n                                   'a female English student with whom he was '\n                                   'acquainted.',\n                 'title': '596 Scheila'},\n                {'idx': 17,\n                 'is_supporting': False,\n                 'paragraph_text': 'William M. Hobby (1899–1942), was a United '\n                                   'States Navy officer killed in action '\n                                   'during World War II for whom a U.S. Navy '\n                                   'ship was named.',\n                 'title': 'William M. Hobby'},\n                {'idx': 18,\n                 'is_supporting': False,\n                 'paragraph_text': 'The Alma Grace McDonough Health and '\n                                   'Recreation Center is a 2,200 seat '\n                                   'multipurpose arena and recreation facility '\n                                   'on the campus of Wheeling Jesuit '\n                                   'University in Wheeling, West Virginia. The '\n                                   'building was constructed thanks to a gift '\n                                   'from Alma Grace McDonough, whom the '\n                                   'building is named after.',\n                 'title': 'Alma Grace McDonough Health and Recreation Center'},\n                {'idx': 19,\n                 'is_supporting': False,\n                 'paragraph_text': 'Émile Bertrand (1844–1909) was a French '\n                                   'mineralogist, in honour of whom '\n                                   'bertrandite was named by Alexis Damour. He '\n                                   'also gave his name to the \"Bertrand lens\" '\n                                   'or phase telescope.',\n                 'title': 'Émile Bertrand'}],\n 'question': 'What is the country where Nissedal is located named after?',\n 'question_decomposition': [{'answer': 'Norway',\n                             'id': 269805,\n                             'paragraph_support_idx': 10,\n                             'question': 'Nissedal &gt;&gt; country'},\n                            {'answer': 'north',\n                             'id': 135710,\n                             'paragraph_support_idx': 6,\n                             'question': 'The #1 was named for whom?'}]}\n\n\nLine Example\n\n\nNone\n\n\n\n\nLooking at a snippet of the predictions below, we see that only four factors are necessary, the id - which matches the question id, the answer - which is the answer to the question, the answerable flag - which is a boolean indicating whether the question can be answered, and the supporting facts - which are the paragraphs that support the answer.\n\n\n\n\nCode\ndisplay(Markdown('**Examples of predictions**'))\nwith jsonlines.open(musique_dir + 'predictions/musique_ans_v1.0_dev_end2end_model_predictions.jsonl', 'r') as file:\n    for i in range(5):\n        display(pprint(file.read()))\n\n\nExamples of predictions\n\n\n{'id': '2hop__460946_294723',\n 'predicted_answer': 'Jennifer Garner',\n 'predicted_answerable': True,\n 'predicted_support_idxs': [0, 10]}\n{'id': '2hop__252311_366220',\n 'predicted_answer': 'Steven Spielberg',\n 'predicted_answerable': True,\n 'predicted_support_idxs': [10, 18]}\n{'id': '2hop__701895_752697',\n 'predicted_answer': 'Cypriot part was merged into the Bank of Cyprus '\n                     '(including insured deposits under 100,000 Euro) and the '\n                     \"'bad' part or legacy entity holds all the overseas \"\n                     'operations as well as uninsured deposits above 100,000 '\n                     'Euro, old shares and bonds. The uninsured depositors '\n                     'were subject to a bail-in and became the new '\n                     'shareholders of the legacy entity. As at May 2017, the '\n                     'legacy entity is one of the largest shareholders of Bank '\n                     'of Cyprus with 4.8% but does not hold a board seat. All '\n                     'the overseas operations, of the now defunct Cyprus '\n                     'Popular Bank, are also held by the legacy entity, until '\n                     'they are sold by the Special Administrator, at first Ms '\n                     'Andri Antoniadou, who ran the legacy entity for two '\n                     'years, from March 2013 until 3 March 2015. She tendered '\n                     'her resignation due to disagreements, with the Governor '\n                     'of the Central Bank of Cyprus and the Central Bank Board '\n                     'members, who amended the lawyers of the legacy entity, '\n                     'without consulting her. Veteran banker Chris [[PP]] The '\n                     'Ciudad Deportiva (\"Sports City\") is a sports complex in '\n                     'Nuevo Laredo, Mexico. It is home to the Tecolotes de '\n                     'Nuevo Laredo Mexican Baseball League team and the Toros '\n                     'de Nuevo Laredo Mexican professional basketball team '\n                     'from the Liga Nacional de Baloncesto Profesional. The '\n                     \"Ciudad Deportiva's Estadio Nuevo Laredo (baseball park) \"\n                     'can seat up to 12,000 fans at a baseball game and the '\n                     'Nuevo Laredo Multidisciplinary Gymnasium can seat 4,000 '\n                     'fans at a basketball game. [[PP]] Juan Carlos Espinoza '\n                     'Mercado (born 23 July 1987 in Machala) is an Ecuadorian '\n                     'professional football player who has played for '\n                     'Ecuadorian club Liga Deportiva Universitaria de Loja and '\n                     'in 2010 he joined Peruvian club Juan Aurich. [[PP]] '\n                     'Estadio Unión Tarma is a multi-use stadium in Tarma, '\n                     'Peru. It is currently used mostly for football matches '\n                     'and is the home stadium of Asociación Deportiva Tarma of '\n                     'the Copa Perú. The stadium holds 9,000 spectators. '\n                     '[[PP]] A Nigerian State is a federated political entity, '\n                     'which shares sovereignty with the Federal Government of '\n                     'Nigeria, There are 36 States in Nigeria, which are bound '\n                     'together by a federal agreement. There is also a '\n                     'territory called the Federal Capital Territory (FCT), '\n                     'which is not a state, but a territory, under the direct '\n                     'control of the Federal Government. The States are '\n                     'further divided into a total of 774 Local Government '\n                     'Areas. Under the Nigerian Constitution, states have the '\n                     'power to ratify constitutional amendments. [[PP]] Ofu '\n                     'Airport is a public airport located one mile (2 km) '\n                     'southeast of the village of Ofu on the island of Ofu in '\n                     'American Samoa, an unincorporated territory of the '\n                     'United States. This airport is publicly owned by '\n                     'Government of American Samoa. [[PP]] The Díaz '\n                     'administration made political decisions and took legal '\n                     'measures that allowed the elite throughout Mexico',\n 'predicted_answerable': True,\n 'predicted_support_idxs': [11, 16, 18]}\n{'id': '2hop__259228_793698',\n 'predicted_answer': 'Fairfield, Connecticut. Its main offices are located at '\n                     '30 Rockefeller Plaza at Rockefeller Center in New York '\n                     'City, known now as the Comcast Building. It was formerly '\n                     'known as the GE Building for the prominent GE logo on '\n                     \"the roof; NBC's headquarters and main studios are also \"\n                     'located in the building. Through its RCA subsidiary, it '\n                     'has been associated with the center since its '\n                     'construction in the 1930s. GE moved its corporate '\n                     'headquarters from the GE Building on Lexington Avenue to '\n                     'Fairfield in 1974. [[PP]] The lander is named after the '\n                     'Philae obelisk, which bears a bilingual inscription and '\n                     'was used along with the Rosetta Stone to decipher '\n                     'Egyptian hieroglyphs. \"Philae\" was monitored and '\n                     \"operated from DLR's Lander Control Center in Cologne\",\n 'predicted_answerable': True,\n 'predicted_support_idxs': [2, 10, 14]}\n{'id': '2hop__481349_302087',\n 'predicted_answer': 'Bombardier Inc. the former CRJ100 and CRJ200 series are '\n                     'no longer in production but still in active airline '\n                     'service, while the more recent CRJ700, CRJ900 and '\n                     'CRJ1000 series are in production and in service. [[PP]] '\n                     'Products offered through the Great Value brand are often '\n                     'claimed to be as good as national brand offerings, but '\n                     'are typically sold at a lower price because of lower '\n                     'marketing and advertising expense. As a house or store '\n                     'brand, the Great Value line does not consist of goods '\n                     'produced by Walmart, but is a labeling system for items '\n                     'manufactured and packaged by a number of agricultural '\n                     'and food corporations, such as ConAgra, Sara Lee which, '\n                     'in addition to releasing products under its own brands '\n                     'and exclusively for Walmart, also manufactures and '\n                     'brands foods for a variety of other chain stores. Often, '\n                     'this labeling system, to the dismay of consumers, does '\n                     'not list location of manufacture of the product. Wal - '\n                     'Mart contends that all Great Value products are produced '\n                     'in the United States. Otherwise, the country of origin '\n                     'would be listed. [[PP]] On June 11, 2006, the British '\n                     'tabloid The Mail on Sunday reported that iPods are '\n                     'mainly manufactured by workers who earn no more than '\n                     'US$50 per month and work 15-hour shifts. Apple '\n                     'investigated the case with independent auditors and '\n                     \"found that, while some of the plant's labour practices \"\n                     \"met Apple's Code of Conduct, others did not: employees \"\n                     'worked over 60 hours a week for 35% of the time, and '\n                     'worked more than six consecutive days for 25% of the '\n                     'time. [[PP]] The EMD E6 was a , A1A-A1A, passenger train '\n                     'locomotive manufactured by Electro-Motive Corporation, '\n                     'and its corporate successor, General Motors',\n 'predicted_answerable': True,\n 'predicted_support_idxs': [5, 10]}\n\n\nNone\n\n\nNone\n\n\nNone\n\n\nNone\n\n\nNone"
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-1/index.html#inputs-and-outputs",
    "href": "technical_blog/knowledge-graph-rag-benchmark-1/index.html#inputs-and-outputs",
    "title": "Don’t RAG on Knowledge Graphs(Or Do) Benchmarking: Theory behind using an LLM to Build Knowledge Graphs – Part One",
    "section": "1.2 Inputs and Outputs",
    "text": "1.2 Inputs and Outputs\nIn essence, our pipeline primarily needs to take the question and the paragraphs and spit out:\n\nWhether the question is answerable.\nWhich paragraphs contribute to the question’s answer.\nThe answer.\n\nNow we’re beginning to see why this is a difficult task. Nevertheless – onwards."
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-1/index.html#jean-claude-van-damme-tell-me-a-haiku",
    "href": "technical_blog/knowledge-graph-rag-benchmark-1/index.html#jean-claude-van-damme-tell-me-a-haiku",
    "title": "Don’t RAG on Knowledge Graphs(Or Do) Benchmarking: Theory behind using an LLM to Build Knowledge Graphs – Part One",
    "section": "4.1 Jean-Claude Van Damme, tell me a Haiku",
    "text": "4.1 Jean-Claude Van Damme, tell me a Haiku\nWhat. Just kidding. We’ll be talking about Anthropic’s Claude 3 models. The following chart is from the LMSYS Chatbot Arena where models go head to head in answering questions which are then chosen by users.\n\n\n\n\n\n\nFigure 4: Comparison of performance and cost among top models\n\n\n\nOn the far right, we have GPT-4 and Claude 3 Opus neck to neck as the highest performing models. As of this writing, the latest GPT-4 Turbo model actually overtook Claude 3 Opus. At the very top, we see Claude Haiku, which performs slightly below one of the GPT-4 models, but at an incredibly low cost. All of the Claude 3 models have a 200,000 token window and a 4096 token output – this is comparable to the 128,000 GPT-4 token window with a 8196 token output. Claude 3 Haiku will be model we’ll be using. If there are any hurdles with that particular model, it will not be too difficult to pivot by simply changing the endpoint to GPT 3.5 or GPT 4.\nHere is Claude 3 Haiku writing a haiku about itself:\nArtificial mind,\nSeeking to understand, learn,\nServe with empathy.\nAre you impressed yet? Maybe a little scared?\n\n\n\n\n\n\nAlthough Claude had the very large context window months before GPT-4, the jury is out on whether it has been useful and robust enough for production.\n\n\n\n\n\n\n\n4.1.1 Claude Tokenization\nUnfortunately, Anthropic has not released a tokenizer that we can use, however, it is generally safe(famous last words lol) to assume that it is quite similar to the OpenAI one. Here, someone has attempted to reverse engineer it by counting the token amounts of the generations streamed to you.\n\nBut we’re not going to do that."
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-1/index.html#strategy",
    "href": "technical_blog/knowledge-graph-rag-benchmark-1/index.html#strategy",
    "title": "Don’t RAG on Knowledge Graphs(Or Do) Benchmarking: Theory behind using an LLM to Build Knowledge Graphs – Part One",
    "section": "5.1 Strategy",
    "text": "5.1 Strategy\n\n5.1.1 Sliding Windows\nTo answer the questions asked in the MuSiQue benchmark, we will create a unique knowledge graph for every individual question, consisting out of the twenty provided paragraphs. Each paragraph can be arbitrarily divided into multiple chunks of text which the LLM can take as input into its context.\n\n\n\n\n\n\nFigure 5: Each question contains multiple paragraphs, and each paragraph is made out of multiple text chunks.\n\n\n\nWe can use a sliding window to process the chunks of text that the paragraphs are composed of. There are numerous ways to insert variable amounts of text into the context of an LLM, but I’ll introduce the two basic approaches. You can do so with a sliding window that takes in one chunk of text after the other, or you can use a sliding window with some overlap. We’ll use the latter strategy, as it may help with continuity of the model’s understanding of the text. As the window slides across the text, we want to generate the nodes and edges of the knowledge graph.\n\n\n\n\n\n\nWhen I say ‘nodes and edges’, I also mean any attributes thereof\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 6: Sliding window with overlap tends to be the standard approach when inserting text into LLMs\n\n\n\n\n\n5.1.2 Knowledge-Stuffing\nConnections are the bread and butter of knowledge graphs. If our LLM is producing nodes and edges only from our limited context window, it appears that we’re missing out on the connectivity benefit of knowledge graphs. To increase the connectivity of our knowledge graph, we can inform our LLM of previous nodes and edges it has created by passing them into the context of the LLM. Conveniently, this gives me the opportunity to introduce our composition of the context we’ll be using.\n\n\n\n\n\n\nFigure 7: We provide the LLM with the system prompt, text chunks, and previously generated nodes and edges\n\n\n\nInside of the prompt we have our:\n\nSystem prompt: Contains the necessary instructions for priming the model(e.g. “you are a brave and beautiful graph creator”), as well as formatting in the case where we want JSON returned to us that represents the nodes and edges, and anything else we’ll need.\nPreviously generated nodes and edges: By knowing the previously generated nodes and edges, we can use them to update or create new nodes and edges that may or may not be related.\nText chunks: The text from the paragraphs which the LLM will be converting to nodes and edges.\n\nUnless we’ll be including all of the nodes and edges into the prompt, it still feels a bit limited. Technically, we can just shove all of those connections into the prompt, as there’s ample space with our huge 200,000 token limit, but we want this method to generalize and scale to tasks outside of this particular dataset.\n\n\n5.1.3 Letting the LLM Loose\nConsider the knowledge graph obtained after we process the 20 paragraphs pertaining to one question using the previously discussed method. We’d get something like:\n\n\n\n\n\n\nFigure 8: Sparsely Connected Knowledge Graph\n\n\n\nThe facts we obtain from the text chunks will likely be connected in fairly atomic clusters as there wouldn’t be great continuity, even with passing some of the previously computed nodes and edges into our context window. One way to fix this would be to feed random sets of nodes(and/or edges) to the LLM and let it generate new connections between the nodes.\n\n\n\n\n\n\nFigure 9: Building New Connections\n\n\n\nThis can be done in one of two ways(more, actually):\n\nPush the nodes and edges(and attributes) into the context window and tell the model to blindly make associations based on that information alone.\nAlong with the nodes and edges, push the segments of text that contributed to the creation of the nodes and edges alongside them. This gives the LLM more grounding and reduces hallucinations.\n\nWe’ll focus on the latter, as it pairs well with the vector store approach we will be discussing later."
  },
  {
    "objectID": "notebooks/musique_eda.html",
    "href": "notebooks/musique_eda.html",
    "title": "",
    "section": "",
    "text": "import panel as pn\npn.extension()\n\n\n\n\n\n\n\n\n\n\n\n  \n\n\n\n\n\nimport jsonlines\n\njs_list = []\nwith jsonlines.open('data/musique_full_v1.0_dev.jsonl') as reader:\n    for i in range(5):\n        js_list.append(reader.read())\njs_list[0]\n\n{'id': '2hop__153573_109006',\n 'paragraphs': [{'idx': 0,\n   'title': 'History of the Internet',\n   'paragraph_text': \"Precursors to the web browser emerged in the form of hyperlinked applications during the mid and late 1980s (the bare concept of hyperlinking had by then existed for some decades). Following these, Tim Berners - Lee is credited with inventing the World Wide Web in 1989 and developing in 1990 both the first web server, and the first web browser, called WorldWideWeb (no spaces) and later renamed Nexus. Many others were soon developed, with Marc Andreessen's 1993 Mosaic (later Netscape), being particularly easy to use and install, and often credited with sparking the internet boom of the 1990s. Today, the major web browsers are Firefox, Internet Explorer, Google Chrome, Opera and Safari.\",\n   'is_supporting': False},\n  {'idx': 1,\n   'title': 'Ceville',\n   'paragraph_text': \"Ceville is a humorous graphic adventure video game developed by the German game studio Realmforge Studios and published by Kalypso Media. Despite the game's use of 3D environments and models, the gameplay is very true to the graphical point-and-click adventure tradition of gameplay, immortalized by game series like Monkey Island from LucasArts and the King's Quest series from Sierra Online.\",\n   'is_supporting': False},\n  {'idx': 2,\n   'title': 'Zipline Safari',\n   'paragraph_text': \"Zipline Safari is a zip-line course in Florida. It is the only zip-line course in the state, and is claimed to be the world's only zip-line created for flat land. Zipline Safari opened on 16 January 2009 in Forever Florida, a wildlife attraction near Holopaw, Florida. The zip-line cost $350,000 to build, and consists of nine platforms built up from the ground and traveled between by zip-lining. Forever Florida built the course to promote ecotourism and interaction with the natural environment of Florida.\",\n   'is_supporting': False},\n  {'idx': 3,\n   'title': 'Parc Safari',\n   'paragraph_text': \"Parc Safari is a zoo in Hemmingford, Quebec, Canada, and is one of the region's major tourist attractions; that has both African & Asian species of elephant.\",\n   'is_supporting': False},\n  {'idx': 4,\n   'title': 'The Reporter (TV series)',\n   'paragraph_text': 'The Reporter is an American drama series that aired on CBS from September 25 to December 18, 1964. The series was created by Jerome Weidman and developed by executive producers Keefe Brasselle and John Simon.',\n   'is_supporting': False},\n  {'idx': 5,\n   'title': 'Earthworm Jim 4',\n   'paragraph_text': 'Earthworm Jim 4 is a video game in the \"Earthworm Jim\" series. It was originally announced by Interplay Entertainment in 2008, and referred to by Interplay as \"still in development\" in May 2011. Later commentary from individual developers would claim that development hadn\\'t started, though desire to create a new entry in the series remained. In May 2019, it was announced that the game was to begin development exclusively for the upcoming Intellivision Amico console.',\n   'is_supporting': False},\n  {'idx': 6,\n   'title': 'Adobe Flash Player',\n   'paragraph_text': 'Availability on desktop operating systems Platform Latest version Browser support Windows XP and later Windows Server 2003 and later 27.0. 0.183 Firefox, Chrome, Chromium, Safari, Opera, Internet Explorer, Microsoft Edge Windows 2000 11.1. 102.55? Windows 98 and ME 9.0. 115.0? Windows 95 and NT 4 7.0. 14.0? Mac OS X 10.6 or later 27.0. 0.183 Firefox, Chrome, Chromium, Safari, Opera Mac OS X 10.5 10.3. 183.90? Classic Mac OS, PowerPC 7.0. 14.0? Classic Mac OS, 68k 5.0? Linux 27.0. 0.183 Firefox, Chrome, Chromium, Opera',\n   'is_supporting': False},\n  {'idx': 7,\n   'title': 'Apple Inc.',\n   'paragraph_text': \"Apple Inc. is an American multinational technology company headquartered in Cupertino, California that designs, develops, and sells consumer electronics, computer software, and online services. The company's hardware products include the iPhone smartphone, the iPad tablet computer, the Mac personal computer, the iPod portable media player, the Apple Watch smartwatch, the Apple TV digital media player, and the HomePod smart speaker. Apple's consumer software includes the macOS and iOS operating systems, the iTunes media player, the Safari web browser, and the iLife and iWork creativity and productivity suites. Its online services include the iTunes Store, the iOS App Store and Mac App Store, Apple Music, and iCloud.\",\n   'is_supporting': False},\n  {'idx': 8,\n   'title': 'Philadelphia Zoo',\n   'paragraph_text': 'The Philadelphia Zoo, located in the Centennial District of Philadelphia, Pennsylvania, on the west bank of the Schuylkill River, was the first true zoo in the United States. Chartered by the Commonwealth of Pennsylvania on March 21, 1859, its opening was delayed by the American Civil War until July 1, 1874. It opened with 1,000 animals and an admission price of 25 cents. For a brief time, the zoo also housed animals brought over from safari on behalf of the Smithsonian Institution, which had not yet built the National Zoo.',\n   'is_supporting': False},\n  {'idx': 9,\n   'title': 'Web browser',\n   'paragraph_text': \"Apple's Safari had its first beta release in January 2003; as of April 2011, it had a dominant share of Apple-based web browsing, accounting for just over 7% of the entire browser market.\",\n   'is_supporting': False},\n  {'idx': 10,\n   'title': 'List of The 100 episodes',\n   'paragraph_text': 'The 100 (pronounced The Hundred) is an American post-apocalyptic science fiction drama television series developed by Jason Rothenberg, which premiered on March 19, 2014, on The CW. It is loosely based on a 2013 book of the same name, the first in a book series by Kass Morgan. The series follows a group of teens as they become the first people from a space habitat to return to Earth after a devastating nuclear apocalypse.',\n   'is_supporting': False},\n  {'idx': 11,\n   'title': 'Shiira',\n   'paragraph_text': 'Shiira (シイラ, Japanese for the common dolphin-fish) is a discontinued open source web browser for the Mac OS X operating system. According to its lead developer Makoto Kinoshita, the goal of Shiira was \"to create a browser that is better and more useful than Safari\". Shiira used WebKit for rendering and scripting. The project reached version 2.3 before it was discontinued, and by December 2011 the developer\\'s website had been removed.',\n   'is_supporting': False},\n  {'idx': 12,\n   'title': 'Traffic Department 2192',\n   'paragraph_text': 'Traffic Department 2192 is a top down shooter game for IBM PC, developed by P-Squared Productions and released in 1994 by Safari Software and distributed by Epic MegaGames. The full game contains three episodes (Alpha, Beta, Gamma), each with twenty missions, in which the player pilots a \"hoverskid\" about a war-torn city to complete certain mission objectives. The game was released as freeware under the Creative Commons License CC BY-ND 3.0 in 2007.',\n   'is_supporting': False},\n  {'idx': 13,\n   'title': 'Maciej Stachowiak',\n   'paragraph_text': \"Maciej Stachowiak (; born June 6, 1976) is a Polish American software developer currently employed by Apple Inc., where he is a leader of the development team responsible for the Safari web browser and WebKit Framework. A longtime proponent of open source software, Stachowiak was involved with the SCWM, GNOME and Nautilus projects for Linux before joining Apple. He is actively involved the development of web standards, and is a co-chair of the World Wide Web Consortium's HTML 5 working group and a member of the Web Hypertext Application Technology Working Group steering committee.\",\n   'is_supporting': False},\n  {'idx': 14,\n   'title': 'Ellery Queen (TV series)',\n   'paragraph_text': 'Ellery Queen is an American TV series, developed by Richard Levinson and William Link, who based it on the fictional character of the same name. The series ran on NBC from September 11, 1975, to April 4, 1976 featuring the titular fictional sleuth. The series stars Jim Hutton as the titular character, and David Wayne as his father, Inspector Richard Queen.',\n   'is_supporting': False},\n  {'idx': 15,\n   'title': 'Hunting',\n   'paragraph_text': 'In the 19th century, southern and central European sport hunters often pursued game only for a trophy, usually the head or pelt of an animal, which was then displayed as a sign of prowess. The rest of the animal was typically discarded. Some cultures, however, disapprove of such waste. In Nordic countries, hunting for trophies was—and still is—frowned upon. Hunting in North America in the 19th century was done primarily as a way to supplement food supplies, although it is now undertaken mainly for sport.[citation needed] The safari method of hunting was a development of sport hunting that saw elaborate travel in Africa, India and other places in pursuit of trophies. In modern times, trophy hunting persists and is a significant industry in some areas.[citation needed]',\n   'is_supporting': False},\n  {'idx': 16,\n   'title': 'Safari School',\n   'paragraph_text': 'Safari School is a BBC Two reality television series presented by Dr Charlotte Uhlenbroek in which eight celebrities take part in a four-week ranger training course in the Shamwari Game Reserve in South Africa.',\n   'is_supporting': False},\n  {'idx': 17,\n   'title': 'African Safari Wildlife Park',\n   'paragraph_text': 'The African Safari Wildlife Park is a drive through wildlife park in Port Clinton, Ohio, United States. Visitors can drive through the preserve and watch and feed the animals from their car. Visitors can spend as much time in the preserve as they wish, observing and feeding the animals, before proceeding to the walk through part of the park, called Safari Junction. The park is closed during the winter.',\n   'is_supporting': False},\n  {'idx': 18,\n   'title': 'White armored car',\n   'paragraph_text': 'The White armored car was a series of armored cars developed by the White Motor Company in Cleveland, Ohio from 1915.',\n   'is_supporting': False},\n  {'idx': 19,\n   'title': 'Blue Tea Games',\n   'paragraph_text': 'The 14th game of this series. The BETA game was released in September 2017. This episode will be developed by Blue Tea Games who return to the series since 2014.',\n   'is_supporting': False}],\n 'question': \"Who developed the eponymous character from the series that contains Mickey's Safari in Letterland?\",\n 'question_decomposition': [{'id': 153573,\n   'question': \"What series is Mickey's Safari in Letterland from?\",\n   'answer': 'Mickey Mouse',\n   'paragraph_support_idx': None},\n  {'id': 109006,\n   'question': 'Who developed #1 ?',\n   'answer': 'Walt Disney',\n   'paragraph_support_idx': None}],\n 'answer': 'Walt Disney',\n 'answer_aliases': [],\n 'answerable': False}\n\n\n\njs_list[0].keys()\n\n\npn.pane.JSON(js_list[-1])\n\n\nfrom pprint import pprint\n\n\nsupporting_paragraphs = [paragraph for paragraph in js_list[-1]['paragraphs'] if paragraph.get('is_supporting', False)]\n\npprint(supporting_paragraphs)\n\n[{'idx': 3,\n  'is_supporting': True,\n  'paragraph_text': 'Lloyd Dane (August 19, 1925 – December 11, 2015) was a '\n                    'NASCAR Grand National Series driver from Eldon, Missouri. '\n                    'He participated part-time in the 1951 and 1954 to 1964 '\n                    'seasons, capturing four wins, all in his own car. Two of '\n                    \"Dane's wins came during the 1956 season, when he finished \"\n                    'a career best 23rd in points.',\n  'title': 'Lloyd Dane'},\n {'idx': 11,\n  'is_supporting': True,\n  'paragraph_text': 'Eldon is a city in Miller County, Missouri, United '\n                    'States, located thirty miles southwest of Jefferson City. '\n                    'The population was 4,567 at the 2010 census.',\n  'title': 'Eldon, Missouri'}]\n\n\n\njs_list[0]\n\n\ndisplay(js_list[-1]['question'])\n\np_list = []\nfor paragraph in js_list[-1]['paragraphs']:\n    if paragraph.get('is_supporting', False):\n        p_list.append(paragraph)\npprint(p_list)\n\n\"Which county does Lloyd Dane's birthplace belong to?\"\n\n\n[{'idx': 3,\n  'is_supporting': True,\n  'paragraph_text': 'Lloyd Dane (August 19, 1925 – December 11, 2015) was a '\n                    'NASCAR Grand National Series driver from Eldon, Missouri. '\n                    'He participated part-time in the 1951 and 1954 to 1964 '\n                    'seasons, capturing four wins, all in his own car. Two of '\n                    \"Dane's wins came during the 1956 season, when he finished \"\n                    'a career best 23rd in points.',\n  'title': 'Lloyd Dane'},\n {'idx': 11,\n  'is_supporting': True,\n  'paragraph_text': 'Eldon is a city in Miller County, Missouri, United '\n                    'States, located thirty miles southwest of Jefferson City. '\n                    'The population was 4,567 at the 2010 census.',\n  'title': 'Eldon, Missouri'}]\n\n\n\ndef count_supporting_paragraphs(json_obj):\n    count = 0\n    for paragraph in json_obj['paragraphs']:\n        if paragraph.get('is_supporting', False):\n            count += 1\n    return count\n\n# Example usage\nnum_supporting_paragraphs = count_supporting_paragraphs(js_list[-1])\nprint(f\"Number of supporting paragraphs: {num_supporting_paragraphs}\")\n\nNumber of supporting paragraphs: 2"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Dmitriy Leybel",
    "section": "",
    "text": "If you’re here, you probably know my name. If you don’t, it’s Dmitriy.\nIn any case, welcome to my page!\nBy profession, I’m a founder, consultant, and data scientist. Those are but some of the hats I’ve worn. At this point, I’ve probably worked with every part of the tech stack(including MPUs and MCUs).\nExcept for bare-metal DevOps. We don’t speak of bare-metal DevOps in these parts.\nAbove all else, I consider myself a tinkerer.\n\n\n\nI run a data consultancy, Prudent Patterns, specializing in data of all sizes, big and small alike. If you’re looking for strategic guidance around machine learning, data quality, data infrastructure, Large Language Models, statistical analysis, data visualization, or experimentation, feel free to shoot me an email, here (dmleybel at gmail dot com).\nA side project of mine and micro-startup that I’ve founded is Hippograph. The nomenclature combines hippocampus and graph, as well as a play on the word hippogriff, y’know, the mythical creature(yeah, sometimes I consider myself clever). As the name suggests, it uses knowledge graphs as a structured memory for answering questions about corpuses of data, which it first deconstructs to the fundamentals necessary for approaching the desired lines of questioning. It’s easier demo’d than said, so I’d suggest you check out the video on its site. :) Also, feel free to reach out (dmleybel at gmail dot com) if you’re interested in teaming up.\nI am also an avid enjoyer of Corgis. A corgoisseur, one may say."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "I was born in Kiev, Ukraine but I moved to Los Angeles, CA at the age of 5 – where I’ve lived most of my life. After a couple of decades of unyielding sun and pleasant weather, I decided that a change of scenery was in order. So I moved to Oregon."
  },
  {
    "objectID": "notebooks/cross_test.html",
    "href": "notebooks/cross_test.html",
    "title": "Doc Load",
    "section": "",
    "text": "import os\nfrom collections import OrderedDict\nfrom collections.abc import Collection\nfrom uuid import uuid4\nfrom functools import partial\nimport json\nimport logging\nimport logging.config\nfrom copy import deepcopy\n\nimport param\n\nimport panel as pn\nfrom panel.chat import ChatMessage, ChatInterface, ChatFeed\nfrom panel.theme import Material\nfrom panel.reactive import ReactiveHTML\n\nfrom langchain_openai import ChatOpenAI\nfrom langchain.text_splitter import RecursiveCharacterTextSplitter\nfrom langchain_community.embeddings import OpenAIEmbeddings\nfrom langchain_core.prompts import (\n    ChatPromptTemplate,\n    HumanMessagePromptTemplate,\n    SystemMessagePromptTemplate,\n    MessagesPlaceholder,\n)\nfrom langchain.schema.runnable import RunnableLambda\nfrom langchain_core.messages import SystemMessage, HumanMessage\nfrom langchain_core.output_parsers import (\n    StrOutputParser,\n    JsonOutputParser,\n    BaseTransformOutputParser,\n)\nfrom langchain_core.memory import BaseMemory\nfrom langchain_core.runnables import RunnablePassthrough\n\nfrom typing import Dict, List, Union, Tuple, Optional\nfrom pydantic.v1 import BaseModel, Field\n\n\nfrom neo4j import GraphDatabase\n\nimport tiktoken\n\nimport pandas as pd\nimport datetime as dt\nimport numpy as np\nimport asyncio\nfrom dotenv import load_dotenv\nimport re\nimport time\nfrom pprint import pprint\n\nfrom ui_helpers import DraggableList\nfrom langchain_helpers import token_len, JsonNodesEdgesStreamParser, initialize_nb, VisJSHandler, GraphHistory\n\nfrom IPython.display import clear_output, display\n\n\npn.extension()\n\n\n\n\n\n\n\n\n\n\n\n  \n\n\n\n\n\nwith open('logs/logging_config.json', 'r') as f:\n    config = json.load(f)\nlogging.config.dictConfig(config)\nlogger = logging.getLogger('root')\n\n\nwith open(\"lean_startup_article.txt\", \"r\") as f:\n    txt = f.read()\ntext_splitter = RecursiveCharacterTextSplitter(\n    chunk_size=260, chunk_overlap=20, length_function=token_len\n)\nsplit = text_splitter.create_documents([txt])\npprint(split[5].page_content)\n\n('When it comes time to grow your team, Jeff Jordan and Eric pointed out three '\n 'hiring mistakes to avoid.\\n'\n 'First, do not hire someone just because they have the domain expertise. You '\n 'want to be sure that they can work with the resources you can provide in '\n 'terms of staff size and budgets. In other words, be sure they are ready to '\n 'work at a startup. Jeff elaborated, “You want to tee [your hires] to the '\n 'state of the company.” For example, don’t court public-ready CFOs when your '\n 'financials aren’t even on QuickBooks yet.\\n'\n 'Second, don’t simply hire your buddies. “You’re kind of looking for '\n 'founders,” not friends, remarked Jeff. “If you know the true story of any '\n '[startup], the early employees are every bit as entrepreneurial, every bit '\n 'as dedicated … as the true founder,” Eric seconded.')\n\n\n\nPrompting\n\nclass Node(BaseModel):\n    semantic_id: str = Field(..., description=\"The unique identifier of the node that is reference to create edges between different nodes.\")\n    category: str = Field(..., description=\"The category of the node\")\n    attributes: Optional[Dict[str, Union[str, int, bool]]] = Field(None, description=\"Additional properties of the node\")\n\nclass Edge(BaseModel):\n    from_node: str = Field(..., description=\"The id of the node from which the edge originates. Only semantic_ids belong here, nothing else.\")\n    to_node: str = Field(..., description=\"The id of the node to which the edge connects. Only semantic_ids belong here, nothing else.\")\n    category: str = Field(..., description=\"The type of the relationship\")\n    attributes: Optional[Dict[str, Union[str, int, bool]]] = Field(None, description=\"Additional properties of the edge\")\n\nclass Graph(BaseModel):\n    nodes: List[Node] = Field(...,description=\"A list of nodes in the graph\")\n    edges: List[Edge] = Field(...,description=\"A list of edges in the graph\")\n\n# json_template = json.dumps(json_template_dict)\n\njson_rules = \\\n\"\"\"We need to create a JSON object that contains a list of nodes and edges that connect the nodes.\nBoth, nodes and edges, have optional attributes.\nYour goal is to extract as much pertinent information from the passage as possible and create nodes and edges with the extracted information.\nIf history is provided, it will be in the JSON schema you are given. You may create new connections between the nodes and edges in the history and the new nodes you are producing.\nIf you wish to change/update any of the node attributes in the provided history based on newly gathered information, simply reuse the semantic_ids of the nodes you wish to change.\nIf you wish to modify/update the edge attributes in the history, reuse the semantic_ids of the 'from' and 'to' nodes of any edge you wish to change.\nUse the following schema and make sure to read the descriptions:\n\"\"\" \n\njson_prompt_instructions = json_rules + Graph.schema_json() + \"\\n-----\\n\"\n\ngraph_creator_content = \\\n\"\"\"You are a brilliant and efficient creator of json objects that capture the essence of passages and who follows instructions unbelievably well.\nYou will be first given instructions and a json schema, then you will be provided a passage to extract the information from.\nYour instructions are:\n{instructions}\nHistory:\n{history}\n\"\"\"\ngraph_analyst_prompt = SystemMessagePromptTemplate.from_template(template=graph_creator_content,\n                              partial_variables={'instructions': json_prompt_instructions})\npass_passage_content = \"Below is the passage to extract the values from.\\n*****\\nPassage:\\n{passage}\"\npass_passage_template = HumanMessagePromptTemplate.from_template(pass_passage_content)\n\ngen_template = graph_analyst_prompt + pass_passage_template\nllm35 = ChatOpenAI(model='gpt-3.5-turbo-0125')\nllm4 = ChatOpenAI(model='gpt-4-1106-preview')\n\n\n\nNetwork Viz\n\n# Working Class\nclass VisJSNetwork(ReactiveHTML):\n    nodes = param.List([])\n    edges = param.List([])\n    # Needed for adding nodes and edges without sending all nodes and edges\n    new_nodes = param.List([])\n    new_edges = param.List([])\n\n    def add_nodes(self, nodes):\n        if not isinstance(nodes, List):\n            nodes = [nodes]\n        logger.debug(f\"Adding nodes: {nodes}\")\n        self.new_nodes.extend(nodes)\n        self.nodes.extend(nodes)\n        self.param.trigger(\"new_nodes\")\n        self.new_nodes = []\n\n    def add_edges(self, edges):\n        if not isinstance(edges, List):\n            edges = [edges]\n        logger.debug(f\"Adding edges: {edges}\")\n        self.new_edges.extend(edges)\n        self.edges.extend(edges)\n        self.param.trigger(\"new_edges\")\n        self.new_edges = []\n\n    def add_item(self, item):\n        item_type = next(iter(item.keys()))\n        if item_type == 'nodes':\n            self.add_nodes(item['nodes'])\n        elif item_type == 'edges':\n            self.add_edges(item['edges'])    \n\n    _template = \"\"\"\n    &lt;div id=\"mynetwork\" class=\"mynetwork\" style=\"height: 800px; width: 1000px; background-color: #1f2455;\"&gt;&lt;/div&gt;\n    &lt;div id=\"config\"&gt;&lt;/div&gt;\n    &lt;link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" /&gt;\n&lt;link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin /&gt;\n&lt;link href=\"https://fonts.googleapis.com/css2?family=Sora:wght@300&display=swap\" rel=\"stylesheet\" /&gt;\n\n    \"\"\"\n\n    _scripts = {\n        \"add_nodes_js\": \"\"\"return function(nodes) { \nfor (var i = 0; i &lt; nodes.length; i++) {\n    var node = nodes[i];\n    var label = \"\";\n    var groupAdded = false;\n    for (var key in node) {\n        if (key != 'id' && key != 'font' && key != 'semantic_id') {  // Exclude 'id', 'font' and 'semantic_id' from the attributes\n            var keyFormatted = \"&lt;b&gt;\" + key + \"&lt;/b&gt;:\\\\n\";\n            var valueFormatted = node[key].toString();\n            // Split key to adhere to the 30 character limit per line\n            if (keyFormatted.length &gt; 30) {\n                var keySplitIndex = keyFormatted.lastIndexOf(' ', 30);\n                if (keySplitIndex == -1) keySplitIndex = 30; // Split at 30 if no spaces\n                keyFormatted = keyFormatted.substring(0, keySplitIndex) + \"\\\\n\";\n            }\n            label += keyFormatted;\n            // Split value to adhere to the 30 character limit per line\n            while (valueFormatted.length &gt; 0) {\n                if (valueFormatted.length &gt; 30) {\n                    var valueSplitIndex = valueFormatted.lastIndexOf(' ', 30);\n                    if (valueSplitIndex == -1) valueSplitIndex = 30; // Split at 30 if no spaces\n                    label += valueFormatted.substring(0, valueSplitIndex) + \"\\\\n\";\n                    valueFormatted = valueFormatted.substring(valueSplitIndex).trim();\n                } else {\n                    label += valueFormatted + \"\\\\n\";\n                    break; // Exit loop if the rest of the value fits in one line\n                }\n            }\n        }\n    }\n    // Replace special HTML characters in the label\n    node['label'] = label.replace(/&/g, \"&amp;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n};\nnetwork_nodes.update(nodes);\n};\n\"\"\",\n        \n        \"add_edges_js\": \"\"\"return function(edges) { \nfor (var i = 0; i &lt; edges.length; i++) {\n    var edge = edges[i];\n    var label = \"\";\n    var fromToAdded = false;\n    for (var key in edge) {\n        if (key != 'from' && key != 'to' && key != 'id') {  // Exclude 'from', 'to' and 'id' from the attributes\n            if (key == 'label' && !fromToAdded) {\n                label += \"&lt;b&gt;\" + key + \"&lt;/b&gt;:\\\\n\" + edge[key] + \"\\\\n\";\n                fromToAdded = true;\n            } else {\n                label += \"&lt;b&gt;\" + key + \"&lt;/b&gt;:\\\\n\" + edge[key] + \"\\\\n\";\n            }\n        }\n    }\n    edge['label'] = label.replace(/&/g, \"&amp;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n};\nnetwork_edges.update(edges);\n};\n\n\"\"\",\n        \"after_layout\": \"\"\"\nnetwork_nodes = new vis.DataSet();\nself.add_nodes_js()(data.nodes);\nnetwork_edges = new vis.DataSet();\nself.add_edges_js()(data.edges);\nnetwork_data = {nodes: network_nodes, edges: network_edges};\n\n// network.fit()\nvar options = {\n    nodes: {\n        shape: 'box',\n        shapeProperties: {\n            borderRadius: 6\n        },\n        font: {\n            face: 'Palatino Linotype',\n            align: 'left',\n            color: '#1f2455',\n            multi: 'html',\n            bold: {\n                face: 'Lucida Sans Unicode',\n                size: 12\n            }\n        },\n        borderWidth: 3,\n        color: {\n            border: '#b73e3d'\n        },\n        shadow: {\n            enabled: true,\n            color: '#b73e3d',\n            size: 5,\n            x: 3,\n            y: 3\n        }\n    },\n    edges: {\n        arrows: {\n            to: {enabled: true, scaleFactor:1, type:'arrow'},\n            middle: {enabled: false, scaleFactor:1, type:'arrow'},\n            from: {enabled: false, scaleFactor:1, type:'arrow'}\n        },\n        length: 350,\n        font: {\n            face: 'Palatino Linotype',\n            size: 12,\n            color: '#e9b07d',\n            strokeWidth: 0,\n            strokeColor: '#000000',\n            multi: 'html',\n            align: 'middle',\n            bold: {\n                face: 'Lucida Sans Unicode',\n                size: 12\n                }\n        },\n    }\n}\nvar network = new vis.Network(mynetwork, network_data, options)\n\"\"\",\n        \"new_nodes\": \"\"\"self.add_nodes_js()(data.new_nodes)\"\"\",\n        \"new_edges\": \"\"\"self.add_edges_js()(data.new_edges)\"\"\"\n    }\n    __javascript__ = [\"https://unpkg.com/vis-network/standalone/umd/vis-network.min.js\"]\n    # __javascript_modules__= ['https://cdn.jsdelivr.net/npm/cytoscape-dom-node@1.2.0/src/index.min.js']\n# TODO: Assign special colors to groups once we have a solid flow for group ID\nvisjs_network = VisJSNetwork()\ntry:\n    server.stop()\nfinally:\n    server = pn.serve(pn.Row(visjs_network), port=46582, show=True, title='Knowledge graph sheeeeeeit')\n\n\n\nLoop over pre-generated history to create nodes/edges\n\nimport pickle\nwith open('graph_history.pkl', 'rb') as f:\n    history = pickle.load(f)\n\n\nasync def async_iterable(data_list):\n    for data in data_list:\n        yield data\n\ntup_list = [(str(k), v) for k,v in history.items()]\n\nasync for dat in async_iterable(tup_list):\n    proc_item = VisJSHandler.process_item(dat)\n    await asyncio.sleep(.5)\n    visjs_network.add_item(proc_item)"
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-0/index.html",
    "href": "technical_blog/knowledge-graph-rag-benchmark-0/index.html",
    "title": "Don’t RAG on Knowledge Graphs(Or Do): RAG, Knowledge Graphs, and Benchmarks – Part Zero",
    "section": "",
    "text": "It’s finally happening. It, being me writing a blog entry. (I’m editing this at 10k words. I guess it’s more of an article and less of a blog entry)\nThe motivation behind this series of posts is twofold, to run a basic knowledge graph Retrieval Augmented Generation(RAG) benchmark I can build off of and iteratively improve, and secondarily, to give the reader a ride-along of the process, from choosing a benchmark, creating a knowledge graph, connecting the knowledge graph to a vector store, and so forth. I am going to break down the components of not only a RAG system, but also introduce the necessary parts of any LLM workflow - so there will certainly be something for everyone. You are free to use the table of contents to skip around to what interests you most, or embark on an end-to-end marathon read.\nI fully believe in democratizing the ability to build and test your own LLM tools, as they are a critical frontier of artificial intelligence. That is the path towards progress and away from the centralization of these fantastic technologies."
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#rag",
    "href": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#rag",
    "title": "Don’t RAG on Knowledge Graphs(Or Do): RAG, Knowledge Graphs, and Benchmarks – Part Zero",
    "section": "1.1 RAG",
    "text": "1.1 RAG\nLarge Language Models(LLMs) are fantastic…that is, until you attempt to verify their output.\n\n\n\n\n\n\nFor this reason, RAG has been a fundamental component of truthiness. It also allows you to augment the LLM output through context-stuffing. The amount of tokens you can stuff into your context is not limitless, and so you can’t merely stuff all of your documents and tables into it. Out of this limit emerge dozens of RAG techniques which try to hydrate the prompt. The fine folks at Langchain have illustrated a small portion of these techniques here(Fig 1). Even with the promise of a 10 million token context window, there is no abatement of upcoming RAG techniques and companies built around it.\n\n\n\n\n\n\n\n\nFigure 1: Soiree of RAG techniques\n(Click to enlarge)\nSource: Langchain blog\n\n\n\n\n\n\nAn ever-growing survey of these techniques exists - and even that is not fully exhaustive. P.S. exa.ai is a fantastic source for research. \nFor reference, here(Fig 2) is a diagram of one of the simplest versions of RAG being implemented.\n\n\n\n\n\n\nFigure 2: Basic RAG Example"
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#knowledge-graphs",
    "href": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#knowledge-graphs",
    "title": "Don’t RAG on Knowledge Graphs(Or Do): RAG, Knowledge Graphs, and Benchmarks – Part Zero",
    "section": "1.2 Knowledge Graphs",
    "text": "1.2 Knowledge Graphs\nIt’s much easier to illustrate than explicate what a knowledge graph is(Fig 3). Below, we have a knowledge graph that represents places, people, and things along with their relationships to one another. This is a directed graph, in the sense that the connections flow in one direction - this generally makes it easier to specify the relationships between entities. There are many names for the entities within a knowledge graph as well as the connections between them; one of the most common naming conventions for them are nodes for the entities such as “Bob” or “The Louvre” and edges for the connections between the nodes such as “was created by” or “is located in”. Additionally, these nodes and edges can both have properties or attributes - for instance, the ‘Museum’ node can have attributes that enrich it such as “capacity: 2,000” and the edge ‘visited’ can be assigned a date attribute “date: March 28th, 2005”. You’ll often hear the word triple in reference to two nodes connected by an edge(Node A, Edge, Node B)\n\n\n\n\n\n\nFigure 3: An example of a basic knowledge graph.\n\n\n\nKnowledge graphs are often created within graph databases such as Neo4j, memgraph, or Amazon Neptune. They are often used within enterprises to integrate data from structured and unstructured databases alike to enable a single source of truth or knowledge. In theory, they are fantastic tools for information storage and retrieval, however, in practice they have a lot of quirks that prevent many companies from using them. The distillation of a company’s data into a neat set of nodes and edges is a complex task that requires knowledge graph experts, as well as alignment from all corners of the organization.\nWhile the appeal of knowledge graphs is immense because it appeals to our intuitive sense of informational organization and structure, you can see for yourself how difficult the task is by trying to organize the things on your desk into a knowledge graph. Your brain has no problem with making sense of it all and maintaining its own knowledge representation of what’s in front of your nose, but reproducing it in a knowledge graph is not as straightforward as our intuition leads us to believe.\n“Are you done sh*tting on knowledge graphs, Dmitriy?”\n\n1.2.1 LLM Synergy\nYes. In fact, here I am proudly generating a knowledge graph for the world to see.\nReal-time knowledge graph creation with GPT-3.5 Turbo Using:@LangChainAI @visjsPanel from @HoloViz_org for handling interpreter/browser bidirectional communication pic.twitter.com/P4mtAZDMaP— dmitriy (@DmitriyLeybel) February 18, 2024 \nIt may seem like this is the start of an all-hands meeting that’s 45 minutes too long, but I promise you that it’s not(unless you want it to be?). The word ‘synergy’ is perfect for describing the relationship between LLMs and knowledge graphs. The lowest hanging fruit for this match made in heaven was writing queries. Given a schema, an LLM can query a graph database to retrieve information.\nSome graph databases can be queried with Cypher(a graph querying language):\nMATCH (n:Person)-[r:KNOWS]-&gt;(m:Person)\nWHERE n.name = 'Alice'\nRETURN n, r, m\nIf you’re familiar with SQL, you immediately see the similarities. This query returns the person node n with the name Alice and all of the people(m) she knows(r). Fortunately, LLMs are superb at query languages, so your Cypher prowess can be minimal to nonexistent in order to compose this masterpiece:\n\nyo chatgpt, this is my graph db’s schema:schema here I need you to write a Cypher query that returns all of the people Alice knows\n\nCool. Now we can fire all of these data analysts, right? Maybe next year. (DISCLAIMER: this is a joke, not business advice)\nQuery generation turns out to be fairly popular, with frameworks like Langchain and LlamaIndex creating modules to do just that. Turns out, using LLMs, we can not only build queries, but we can build the knowledge graph itself. I will later go over this at length, so to be brief, you can have a LLM go over a set of documents chunk by chunk and output these triplets of nodes and edges iteratively. After loading them into a graph database, you can end the process there and trot along with your newly minted database, or you can now let the LLM create queries against that database as described earlier.\n\n\nLangchain and LlamaIndex also have their own plug-n-play knowledge graph creation modules.\nAt this point, like any rational human being, you may be asking, can this get any better? I mean, you’ve lasted this long, so I imagine that you already know the answer."
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#rag-knowledge-graphs",
    "href": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#rag-knowledge-graphs",
    "title": "Don’t RAG on Knowledge Graphs(Or Do): RAG, Knowledge Graphs, and Benchmarks – Part Zero",
    "section": "1.3 RAG + Knowledge Graphs",
    "text": "1.3 RAG + Knowledge Graphs\n\n\n\n\n\n\nImportant\n\n\n\nRemember, there is more than one way you can skin a cat. The examples provided are merely the ones I believe are most illustrative of the main components. The extent of the composability is only limited by your imagination.\n\n\nWhen you combine RAG with knowledge graphs, you get the best of both worlds. On one hand, you get a fuzzy(probabalistic) semantic layer which can be used to compare the essence of sentences or paragraphs to via embeddings. On the other, you have a discrete and symbolic representation of knowledge. That sounds an awful lot like humans – vibes-based logical processors.\nThere are limitless ways to construct a system that exploits both modalities, so I’m going to focus on the base cases. The fundamental relationship takes place between the vector embeddings and the knowledge graph. The nodes(and in some cases, the edges) are linked to an embedding related to their source material.\nThe first objective is to use an LLM to create the knowledge graph in conjunction with the embeddings. The embeddings will be stored in a vector database or vector store, which is essentially an optimized container that allows extremely fast vector comparison operations so you can quickly find the most similar embeddings. Some vector databases live in the cloud(Pinecone), they can be self-hosted(Chroma), or they can stay in your very program’s memory(FAISS). Fig 4 illustrates the fundamentals of generating your knowledge graph and vector store.\n\n1.3.1 Generating Knowledge Graphs and Populating Vector Stores\nOnce a corpus of documents is chunked into pieces, those pieces can be processed by the LLM and converted into triples which are then loaded into the knowledge graph. Concurrently, embeddings are created for the document chunks and loaded into the vector store. In each case, you can attach the reference for the node or embedding in its respective twin – this is where the magic lies. The text from the chunked documents can be stored in either the knowledge graph or in the vector store, or both. Once both are established, there are multiple retrieval strategies we can use to take advantage of this system.\n\n\n\n\n\n\nNote\n\n\n\nBuilding the knowledge graph sounds simpler than it is, and just as the architectural design of these systems, it is open to myriads of potential options – some good, and some not so good. This will be addressed.\n\n\n\n\n\n\n\n\nFigure 4: Knowledge Graph and Embedding Generation\n\n\n\n\n\n1.3.2 Retrieval Strategy #1 Focused on Embeddings Search Followed by Knowledge Graph Adjacency\nWith a populated vector store and knowledge graph, we are set to experiment with a wide array of retrieval strategies in pursuit of finding the best one to hydrate our prompt. Fig 5 involves using the vector store to find the nearest matching embedding, find its reference in the knowledge graph, and then find the adjacent nodes within the knowledge graph to add to our prompt. This makes intuitive sense because concepts related to the initial node are likely to be relevant for the LLM in addressing the user’s query.\n\n\n\n\n\n\nFigure 5: One strategy of retrieval through first finding a close embedding, and then utilizing the adjacency of nodes in the knowledge graph to hydrate the prompt\n\n\n\n\n\n1.3.3 Retrieval Strategy #2 Focused on Graph Query Generation\nAnother retrieval strategy would switch the knowledge graph and vector store steps around. This will involve an extra call to the LLM in order to construct the query we’ll send to the knowledge graph. Once the nodes(and edges) are returned, we can trace the node to its referenced embedding, and retrieve the neighborhood of embeddings along with their text. Alternatively, we can ignore the embeddings and simply focus on the neighborhood of the returned nodes. For the example in Fig 6, I’ll focus on the former. As much as we both love flowcharts, I have a feeling you’re getting somewhat tired of them. That said, here’s one more.\n\n\n\n\n\n\nFigure 6: Another strategy for retrieval is to generate queries against the graph database containing the knowledge graph, and then."
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#hotpot-and-beer",
    "href": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#hotpot-and-beer",
    "title": "Don’t RAG on Knowledge Graphs(Or Do): RAG, Knowledge Graphs, and Benchmarks – Part Zero",
    "section": "2.1 Hotpot and Beer?",
    "text": "2.1 Hotpot and Beer?\nSingle-hop benchmarking appears to be most popular according to the RAG survey, however, we have more faith in knowledge graphs than a measly single-hop reasoning task. A single-hop requires the information from a single document to answer a question, however a multi-hop task requires you to hop between documents in order to answer the question. HotPotQA appears to be the most popular multi-hop dataset. Mentioned immediately on the HotPotQA website is another dataset which they shout out as newer, with a more diverse set of hops required, while including the HotPotQA dataset within it - BeerQA(is anyone else thirsty…). It combines QA data from three datasets, being HotPotQA, SQuAD, and its own formulated questions from Wikipedia for even more hops. Upon further inspection, BeerQA specifies that it primarily focuses on a fullwiki evaluation, that is to say, you must use the entirety of wikipedia in the task. Due to time and resource constraints, we do not currently want to build a knowledge graph from a 24GB dataset from the get-go. We do, however, want to be able to iterate in a quick and agile manner. HotPotQA doesn’t have the same compute-heavy requirement, and neither does another amusingly named dataset."
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#musique",
    "href": "technical_blog/knowledge-graph-rag-benchmark-0/index.html#musique",
    "title": "Don’t RAG on Knowledge Graphs(Or Do): RAG, Knowledge Graphs, and Benchmarks – Part Zero",
    "section": "2.2 MuSiQue to my ears",
    "text": "2.2 MuSiQue to my ears\nAccording to the HotpotQA paper, it also has the option for using the full wiki in the evaluation criterion, however, it also has a distractor option where you’re given 2 ‘gold’ paragraphs containing the connecting information coupled with 8 irrelevant ‘distractors’ that serve as noise. Another dataset was created as an improvement over HotpotQA as well as its successor, 2WikiMultihopQA – MuSiQue(Multihop Questions via Single-hop QUestion Composition) improves over its predecessors and includes questions with upwards of 18 distractors and numerous gold paragraphs in order to create questions of up to 4 hops. In addition, it handles some cases that would’ve allowed cheating within HotPotQA(such as inferring the information that is present in the hops). In addition, MuSiQue adds answerability to the mix – roughly half of the questions are unanswerable given the data, with the breadcrumbs provided by the provided distractors being misleading.\n\n\n\n\n\n\nThis is a great augmentation because this is the type of eval that will often be present in the real world, since we often expect real world retrieval of information retrieval to come up short.\n\n\n\n\n\n\n\n\nFigure 9: Answerable and Nonanswerable Multihop Questions\n\n\n\n\n\n\nMuSiQue contains two evaluations, one with only answerable questions, and the other, evenly divided between non-answerable and answerable questions. If we look at the MuSiQue leaderboards in Fig 10, we see that the F1 score(harmonic mean of precision and recall – the higher the better) is substantially better for the Answerable dataset, as it removed the option of there being unanswerable questions for the models to hallucinate on.\n\n\n\n\n\n\nFigure 10: MuSiQue Leaderboard Comparison\n\n\n\nBefore wrapping up, I’d like to at least share some of the dev dataset meant to be used in the development of your data pipeline, published in the MuSiQue github repo.\n\n\n\n\nCode\nimport jsonlines\n\njs_list = []\nwith jsonlines.open('data/musique_full_v1.0_dev.jsonl') as reader:\n    for i in range(5):\n        js_list.append(reader.read())\njs_list[0]\n\n\n{'id': '2hop__153573_109006',\n 'paragraphs': [{'idx': 0,\n   'title': 'History of the Internet',\n   'paragraph_text': \"Precursors to the web browser emerged in the form of hyperlinked applications during the mid and late 1980s (the bare concept of hyperlinking had by then existed for some decades). Following these, Tim Berners - Lee is credited with inventing the World Wide Web in 1989 and developing in 1990 both the first web server, and the first web browser, called WorldWideWeb (no spaces) and later renamed Nexus. Many others were soon developed, with Marc Andreessen's 1993 Mosaic (later Netscape), being particularly easy to use and install, and often credited with sparking the internet boom of the 1990s. Today, the major web browsers are Firefox, Internet Explorer, Google Chrome, Opera and Safari.\",\n   'is_supporting': False},\n  {'idx': 1,\n   'title': 'Ceville',\n   'paragraph_text': \"Ceville is a humorous graphic adventure video game developed by the German game studio Realmforge Studios and published by Kalypso Media. Despite the game's use of 3D environments and models, the gameplay is very true to the graphical point-and-click adventure tradition of gameplay, immortalized by game series like Monkey Island from LucasArts and the King's Quest series from Sierra Online.\",\n   'is_supporting': False},\n  {'idx': 2,\n   'title': 'Zipline Safari',\n   'paragraph_text': \"Zipline Safari is a zip-line course in Florida. It is the only zip-line course in the state, and is claimed to be the world's only zip-line created for flat land. Zipline Safari opened on 16 January 2009 in Forever Florida, a wildlife attraction near Holopaw, Florida. The zip-line cost $350,000 to build, and consists of nine platforms built up from the ground and traveled between by zip-lining. Forever Florida built the course to promote ecotourism and interaction with the natural environment of Florida.\",\n   'is_supporting': False},\n  {'idx': 3,\n   'title': 'Parc Safari',\n   'paragraph_text': \"Parc Safari is a zoo in Hemmingford, Quebec, Canada, and is one of the region's major tourist attractions; that has both African & Asian species of elephant.\",\n   'is_supporting': False},\n  {'idx': 4,\n   'title': 'The Reporter (TV series)',\n   'paragraph_text': 'The Reporter is an American drama series that aired on CBS from September 25 to December 18, 1964. The series was created by Jerome Weidman and developed by executive producers Keefe Brasselle and John Simon.',\n   'is_supporting': False},\n  {'idx': 5,\n   'title': 'Earthworm Jim 4',\n   'paragraph_text': 'Earthworm Jim 4 is a video game in the \"Earthworm Jim\" series. It was originally announced by Interplay Entertainment in 2008, and referred to by Interplay as \"still in development\" in May 2011. Later commentary from individual developers would claim that development hadn\\'t started, though desire to create a new entry in the series remained. In May 2019, it was announced that the game was to begin development exclusively for the upcoming Intellivision Amico console.',\n   'is_supporting': False},\n  {'idx': 6,\n   'title': 'Adobe Flash Player',\n   'paragraph_text': 'Availability on desktop operating systems Platform Latest version Browser support Windows XP and later Windows Server 2003 and later 27.0. 0.183 Firefox, Chrome, Chromium, Safari, Opera, Internet Explorer, Microsoft Edge Windows 2000 11.1. 102.55? Windows 98 and ME 9.0. 115.0? Windows 95 and NT 4 7.0. 14.0? Mac OS X 10.6 or later 27.0. 0.183 Firefox, Chrome, Chromium, Safari, Opera Mac OS X 10.5 10.3. 183.90? Classic Mac OS, PowerPC 7.0. 14.0? Classic Mac OS, 68k 5.0? Linux 27.0. 0.183 Firefox, Chrome, Chromium, Opera',\n   'is_supporting': False},\n  {'idx': 7,\n   'title': 'Apple Inc.',\n   'paragraph_text': \"Apple Inc. is an American multinational technology company headquartered in Cupertino, California that designs, develops, and sells consumer electronics, computer software, and online services. The company's hardware products include the iPhone smartphone, the iPad tablet computer, the Mac personal computer, the iPod portable media player, the Apple Watch smartwatch, the Apple TV digital media player, and the HomePod smart speaker. Apple's consumer software includes the macOS and iOS operating systems, the iTunes media player, the Safari web browser, and the iLife and iWork creativity and productivity suites. Its online services include the iTunes Store, the iOS App Store and Mac App Store, Apple Music, and iCloud.\",\n   'is_supporting': False},\n  {'idx': 8,\n   'title': 'Philadelphia Zoo',\n   'paragraph_text': 'The Philadelphia Zoo, located in the Centennial District of Philadelphia, Pennsylvania, on the west bank of the Schuylkill River, was the first true zoo in the United States. Chartered by the Commonwealth of Pennsylvania on March 21, 1859, its opening was delayed by the American Civil War until July 1, 1874. It opened with 1,000 animals and an admission price of 25 cents. For a brief time, the zoo also housed animals brought over from safari on behalf of the Smithsonian Institution, which had not yet built the National Zoo.',\n   'is_supporting': False},\n  {'idx': 9,\n   'title': 'Web browser',\n   'paragraph_text': \"Apple's Safari had its first beta release in January 2003; as of April 2011, it had a dominant share of Apple-based web browsing, accounting for just over 7% of the entire browser market.\",\n   'is_supporting': False},\n  {'idx': 10,\n   'title': 'List of The 100 episodes',\n   'paragraph_text': 'The 100 (pronounced The Hundred) is an American post-apocalyptic science fiction drama television series developed by Jason Rothenberg, which premiered on March 19, 2014, on The CW. It is loosely based on a 2013 book of the same name, the first in a book series by Kass Morgan. The series follows a group of teens as they become the first people from a space habitat to return to Earth after a devastating nuclear apocalypse.',\n   'is_supporting': False},\n  {'idx': 11,\n   'title': 'Shiira',\n   'paragraph_text': 'Shiira (シイラ, Japanese for the common dolphin-fish) is a discontinued open source web browser for the Mac OS X operating system. According to its lead developer Makoto Kinoshita, the goal of Shiira was \"to create a browser that is better and more useful than Safari\". Shiira used WebKit for rendering and scripting. The project reached version 2.3 before it was discontinued, and by December 2011 the developer\\'s website had been removed.',\n   'is_supporting': False},\n  {'idx': 12,\n   'title': 'Traffic Department 2192',\n   'paragraph_text': 'Traffic Department 2192 is a top down shooter game for IBM PC, developed by P-Squared Productions and released in 1994 by Safari Software and distributed by Epic MegaGames. The full game contains three episodes (Alpha, Beta, Gamma), each with twenty missions, in which the player pilots a \"hoverskid\" about a war-torn city to complete certain mission objectives. The game was released as freeware under the Creative Commons License CC BY-ND 3.0 in 2007.',\n   'is_supporting': False},\n  {'idx': 13,\n   'title': 'Maciej Stachowiak',\n   'paragraph_text': \"Maciej Stachowiak (; born June 6, 1976) is a Polish American software developer currently employed by Apple Inc., where he is a leader of the development team responsible for the Safari web browser and WebKit Framework. A longtime proponent of open source software, Stachowiak was involved with the SCWM, GNOME and Nautilus projects for Linux before joining Apple. He is actively involved the development of web standards, and is a co-chair of the World Wide Web Consortium's HTML 5 working group and a member of the Web Hypertext Application Technology Working Group steering committee.\",\n   'is_supporting': False},\n  {'idx': 14,\n   'title': 'Ellery Queen (TV series)',\n   'paragraph_text': 'Ellery Queen is an American TV series, developed by Richard Levinson and William Link, who based it on the fictional character of the same name. The series ran on NBC from September 11, 1975, to April 4, 1976 featuring the titular fictional sleuth. The series stars Jim Hutton as the titular character, and David Wayne as his father, Inspector Richard Queen.',\n   'is_supporting': False},\n  {'idx': 15,\n   'title': 'Hunting',\n   'paragraph_text': 'In the 19th century, southern and central European sport hunters often pursued game only for a trophy, usually the head or pelt of an animal, which was then displayed as a sign of prowess. The rest of the animal was typically discarded. Some cultures, however, disapprove of such waste. In Nordic countries, hunting for trophies was—and still is—frowned upon. Hunting in North America in the 19th century was done primarily as a way to supplement food supplies, although it is now undertaken mainly for sport.[citation needed] The safari method of hunting was a development of sport hunting that saw elaborate travel in Africa, India and other places in pursuit of trophies. In modern times, trophy hunting persists and is a significant industry in some areas.[citation needed]',\n   'is_supporting': False},\n  {'idx': 16,\n   'title': 'Safari School',\n   'paragraph_text': 'Safari School is a BBC Two reality television series presented by Dr Charlotte Uhlenbroek in which eight celebrities take part in a four-week ranger training course in the Shamwari Game Reserve in South Africa.',\n   'is_supporting': False},\n  {'idx': 17,\n   'title': 'African Safari Wildlife Park',\n   'paragraph_text': 'The African Safari Wildlife Park is a drive through wildlife park in Port Clinton, Ohio, United States. Visitors can drive through the preserve and watch and feed the animals from their car. Visitors can spend as much time in the preserve as they wish, observing and feeding the animals, before proceeding to the walk through part of the park, called Safari Junction. The park is closed during the winter.',\n   'is_supporting': False},\n  {'idx': 18,\n   'title': 'White armored car',\n   'paragraph_text': 'The White armored car was a series of armored cars developed by the White Motor Company in Cleveland, Ohio from 1915.',\n   'is_supporting': False},\n  {'idx': 19,\n   'title': 'Blue Tea Games',\n   'paragraph_text': 'The 14th game of this series. The BETA game was released in September 2017. This episode will be developed by Blue Tea Games who return to the series since 2014.',\n   'is_supporting': False}],\n 'question': \"Who developed the eponymous character from the series that contains Mickey's Safari in Letterland?\",\n 'question_decomposition': [{'id': 153573,\n   'question': \"What series is Mickey's Safari in Letterland from?\",\n   'answer': 'Mickey Mouse',\n   'paragraph_support_idx': None},\n  {'id': 109006,\n   'question': 'Who developed #1 ?',\n   'answer': 'Walt Disney',\n   'paragraph_support_idx': None}],\n 'answer': 'Walt Disney',\n 'answer_aliases': [],\n 'answerable': False}\n\n\n\n\nThis is but one entry in the jsonl file. Although it has an answer 'answer': 'Walt Disney', there is not enough supporting evidence within the 20 accompanying paragraph to substantiate that and so it has a label of 'answerable': False. Each paragraph has a is_supporting label that is to be used in evaluating the pipeline’s ability to not only use the information found in these paragraphs, but to also classify these paragraphs as being supporting elements.\nAnd furthermore, here are examples of a couple of gold paragraphs from another question, where is_supporting == True. Here you can witness for yourself the necessary connection between Lloyd Dane and the county of his birthplace. Just one of the paragraphs by itself wouldn’t be enough to make that connection:\n\n\n\nCode\ndisplay(js_list[-1]['question'])\n\np_list = []\nfor paragraph in js_list[-1]['paragraphs']:\n    if paragraph.get('is_supporting', False):\n        p_list.append(paragraph)\npprint(p_list)\n\n\n\"Which county does Lloyd Dane's birthplace belong to?\"\n\n\n[{'idx': 3,\n  'is_supporting': True,\n  'paragraph_text': 'Lloyd Dane (August 19, 1925 – December 11, 2015) was a '\n                    'NASCAR Grand National Series driver from Eldon, Missouri. '\n                    'He participated part-time in the 1951 and 1954 to 1964 '\n                    'seasons, capturing four wins, all in his own car. Two of '\n                    \"Dane's wins came during the 1956 season, when he finished \"\n                    'a career best 23rd in points.',\n  'title': 'Lloyd Dane'},\n {'idx': 11,\n  'is_supporting': True,\n  'paragraph_text': 'Eldon is a city in Miller County, Missouri, United '\n                    'States, located thirty miles southwest of Jefferson City. '\n                    'The population was 4,567 at the 2010 census.',\n  'title': 'Eldon, Missouri'}]"
  },
  {
    "objectID": "technical_blog/knowledge-graph-rag-benchmark-1/notebooks/kg_build.html",
    "href": "technical_blog/knowledge-graph-rag-benchmark-1/notebooks/kg_build.html",
    "title": "Explore",
    "section": "",
    "text": "from langchain.text_splitter import RecursiveCharacterTextSplitter\nfrom jsonlines import jsonlines\n\nfrom IPython.display import display, Markdown\nfrom pprint import pprint\n\n\nmusique_dir = '../musique/musique/'\n\n\nimport panel as pn\npn.extension()\n\n\n\n\n\n\n\n\n\n\n\n  \n\n\n\n\n\nData JSONLines\n\nwith jsonlines.open(musique_dir + 'data/musique_full_v1.0_train.jsonl') as reader:\n    num_lines = sum(1 for _ in reader)\n\nprint(f'Number of lines in the file: {num_lines}')\n\nNumber of lines in the file: 39876\n\n\n\nwith jsonlines.open(musique_dir + '/data/musique_full_v1.0_train.jsonl') as reader:\n    lines = [reader.read() for _ in range(1000)]\ndisplay(Markdown('**Line Example**'), pprint(lines[1]))\n\n{'answer': 'north',\n 'answer_aliases': ['North', 'N'],\n 'answerable': True,\n 'id': '2hop__269805_135710',\n 'paragraphs': [{'idx': 0,\n                 'is_supporting': False,\n                 'paragraph_text': 'Milton F. Pavlic (1909–1942) was a United '\n                                   'States Navy officer killed in action '\n                                   'during World War II for whom a U.S. Navy '\n                                   'high-speed transport was named.',\n                 'title': 'Milton F. Pavlic'},\n                {'idx': 1,\n                 'is_supporting': False,\n                 'paragraph_text': 'Osmund Holm-Hansen (also known as Oz '\n                                   'Holm-Hansen) is a Norwegian-born American '\n                                   'scientist, for whom Mount Holm-Hansen, in '\n                                   'Antarctica is named. A plant physiologist '\n                                   'by training, from 1962 Holm-Hansen was the '\n                                   'head of polar research at the Scripps '\n                                   'Institution of Oceanography.',\n                 'title': 'Osmund Holm-Hansen'},\n                {'idx': 2,\n                 'is_supporting': False,\n                 'paragraph_text': '\"Sapphire Princess\" was built in Japan by '\n                                   'Mitsubishi Heavy Industries, the second '\n                                   'Princess Cruises ship to be built in a '\n                                   'Japanese shipyard. Her only sister ship is '\n                                   '\"Diamond Princess\", with whom she swapped '\n                                   'names during construction.',\n                 'title': 'Sapphire Princess'},\n                {'idx': 3,\n                 'is_supporting': False,\n                 'paragraph_text': 'Lake Pontchartrain is named for Louis '\n                                   'Phélypeaux, comte de Pontchartrain. He was '\n                                   'the French Minister of the Marine, '\n                                   'Chancellor, and Controller-General of '\n                                   \"Finances during the reign of France's \"\n                                   '\"Sun King\", Louis XIV, for whom the colony '\n                                   'of \"La Louisiane\" was named.',\n                 'title': 'Lake Pontchartrain'},\n                {'idx': 4,\n                 'is_supporting': False,\n                 'paragraph_text': 'Henry Crater is a large crater in the '\n                                   'Arabia quadrangle of Mars, located at '\n                                   '10.9° north latitude and 23.3° east '\n                                   'longitude. It is in diameter and was named '\n                                   'after the brothers Paul Henry and Prosper '\n                                   'Henry, both of whom were French telescope '\n                                   'makers and astronomers.',\n                 'title': 'Henry (Martian crater)'},\n                {'idx': 5,\n                 'is_supporting': False,\n                 'paragraph_text': 'Where Dead Voices Gather is a book by Nick '\n                                   'Tosches. It is, in part, a biography of '\n                                   'Emmett Miller, one of the last minstrel '\n                                   'singers. Just as importantly, it depicts '\n                                   \"Tosches' search for information about \"\n                                   'Miller, about whom he initially wrote in '\n                                   'his book \"Country: The Twisted Roots of '\n                                   'Rock and Roll\". It is also a study of '\n                                   'minstrelsy and its connection to American '\n                                   'folk music, country music, the blues and '\n                                   'ultimately, rock and roll. In that way, it '\n                                   'is a companion volume to his other books '\n                                   'of music journalism, \"Country\" and \"Unsung '\n                                   'Heroes of Rock N\\' Roll\".',\n                 'title': 'Where Dead Voices Gather'},\n                {'idx': 6,\n                 'is_supporting': True,\n                 'paragraph_text': 'Norway has a total area of and a '\n                                   'population of 5,312,300 (as of August '\n                                   '2018). The country shares a long eastern '\n                                   'border with Sweden (1,619 km or 1,006\\xa0'\n                                   'mi long). Norway is bordered by Finland '\n                                   'and Russia to the north-east, and the '\n                                   'Skagerrak strait to the south, with '\n                                   'Denmark on the other side. Norway has an '\n                                   'extensive coastline, facing the North '\n                                   'Atlantic Ocean and the Barents Sea. The '\n                                   \"maritime influence also dominates Norway's \"\n                                   'climate with mild lowland temperatures on '\n                                   'the sea coasts, whereas the interior, '\n                                   'while colder, also is a lot milder than '\n                                   'areas elsewhere in the world on such '\n                                   'northerly latitudes. Even during polar '\n                                   'night in the north, temperatures above '\n                                   'freezing are commonplace on the coastline. '\n                                   'The maritime influence brings high '\n                                   'rainfall and snowfall to some areas of the '\n                                   'country.',\n                 'title': 'Norway'},\n                {'idx': 7,\n                 'is_supporting': False,\n                 'paragraph_text': 'The Hireling Shepherd (1851) is a painting '\n                                   'by the Pre-Raphaelite artist William '\n                                   'Holman Hunt. It represents a shepherd '\n                                   'neglecting his flock in favour of an '\n                                   'attractive country girl to whom he shows a '\n                                   \"death's-head hawkmoth. The meaning of the \"\n                                   'image has been much debated.',\n                 'title': 'The Hireling Shepherd'},\n                {'idx': 8,\n                 'is_supporting': False,\n                 'paragraph_text': 'Naissa Mosque is a mosque in Qardaha, '\n                                   'along the Syrian coast. It was built in '\n                                   '1989 by architect Abdul Rahman Naassan, '\n                                   'and funded by the mother of former '\n                                   'president Hafez al-Assad, Naissa '\n                                   'Assad—after whom the mosque was named. The '\n                                   'state funeral of Hafez al-Assad was '\n                                   'observed at the mosque.',\n                 'title': 'Naissa Mosque'},\n                {'idx': 9,\n                 'is_supporting': False,\n                 'paragraph_text': 'The quick German victory over the French '\n                                   'stunned neutral observers, many of whom '\n                                   'had expected a French victory and most of '\n                                   'whom had expected a long war. The '\n                                   'strategic advantages possessed by the '\n                                   'Germans were not appreciated outside '\n                                   'Germany until after hostilities had '\n                                   'ceased. Other countries quickly discerned '\n                                   'the advantages given to the Germans by '\n                                   'their military system, and adopted many of '\n                                   'their innovations, particularly the '\n                                   'General Staff, universal conscription and '\n                                   'highly detailed mobilization systems.',\n                 'title': 'Franco-Prussian War'},\n                {'idx': 10,\n                 'is_supporting': True,\n                 'paragraph_text': 'Tveitsund is a village in Nissedal '\n                                   'municipality, Norway. The urban area '\n                                   'Tveitsund, which consists of Tveitsund and '\n                                   'Treungen, has a population of 361.',\n                 'title': 'Tveitsund'},\n                {'idx': 11,\n                 'is_supporting': False,\n                 'paragraph_text': 'John Francis Sheehan (1910–1942) was a '\n                                   'United States Navy sailor killed in action '\n                                   'during World War II for whom a destroyer '\n                                   'escort was named during the war.',\n                 'title': 'John Francis Sheehan'},\n                {'idx': 12,\n                 'is_supporting': False,\n                 'paragraph_text': 'Holmes Summit is a peak rising to , the '\n                                   'highest elevation in the Read Mountains of '\n                                   'the Shackleton Range in Antarctica. It was '\n                                   'photographed from the air by the U.S. Navy '\n                                   'in 1967 and was surveyed by the British '\n                                   'Antarctic Survey in the period 1968–71. In '\n                                   'association with the names of geologists '\n                                   'grouped in this area, it was named by the '\n                                   'UK Antarctic Place-Names Committee in 1971 '\n                                   'after Professor Arthur Holmes, after whom '\n                                   'the Holmes Hills in Palmer Land were also '\n                                   'named.',\n                 'title': 'Holmes Summit'},\n                {'idx': 13,\n                 'is_supporting': False,\n                 'paragraph_text': ', better known by her pen name is a '\n                                   'Japanese manga artist. She is married to '\n                                   'fellow manga artist Tatsuneko, from whom '\n                                   'he took the name of . She is a graduate of '\n                                   'Mita Senior High School, Tokyo. She '\n                                   'currently lives in Setagaya, Tokyo with '\n                                   'her husband and daughter.',\n                 'title': 'Yun Kōga'},\n                {'idx': 14,\n                 'is_supporting': False,\n                 'paragraph_text': 'The Book of Proper Names () is a Belgian '\n                                   'novel by Amélie Nothomb. It was first '\n                                   'published in 2002. It is a romanticized '\n                                   'account of the life of the singer RoBERT, '\n                                   'whom Nothomb became acquainted with as an '\n                                   'avid admirer of her songs.',\n                 'title': 'The Book of Proper Names'},\n                {'idx': 15,\n                 'is_supporting': False,\n                 'paragraph_text': '653 Berenike is a main-belt asteroid '\n                                   'discovered on November 27, 1907, by Joel '\n                                   'Hastings Metcalf at Taunton, '\n                                   'Massachusetts. It is named after Berenice '\n                                   'II of Egypt, after whom the constellation '\n                                   'Coma Berenices is also named.',\n                 'title': '653 Berenike'},\n                {'idx': 16,\n                 'is_supporting': False,\n                 'paragraph_text': 'orbiting the Sun. It was discovered on 21 '\n                                   'February 1906 by August Kopff from '\n                                   'Heidelberg. Kopff named the asteroid after '\n                                   'a female English student with whom he was '\n                                   'acquainted.',\n                 'title': '596 Scheila'},\n                {'idx': 17,\n                 'is_supporting': False,\n                 'paragraph_text': 'William M. Hobby (1899–1942), was a United '\n                                   'States Navy officer killed in action '\n                                   'during World War II for whom a U.S. Navy '\n                                   'ship was named.',\n                 'title': 'William M. Hobby'},\n                {'idx': 18,\n                 'is_supporting': False,\n                 'paragraph_text': 'The Alma Grace McDonough Health and '\n                                   'Recreation Center is a 2,200 seat '\n                                   'multipurpose arena and recreation facility '\n                                   'on the campus of Wheeling Jesuit '\n                                   'University in Wheeling, West Virginia. The '\n                                   'building was constructed thanks to a gift '\n                                   'from Alma Grace McDonough, whom the '\n                                   'building is named after.',\n                 'title': 'Alma Grace McDonough Health and Recreation Center'},\n                {'idx': 19,\n                 'is_supporting': False,\n                 'paragraph_text': 'Émile Bertrand (1844–1909) was a French '\n                                   'mineralogist, in honour of whom '\n                                   'bertrandite was named by Alexis Damour. He '\n                                   'also gave his name to the \"Bertrand lens\" '\n                                   'or phase telescope.',\n                 'title': 'Émile Bertrand'}],\n 'question': 'What is the country where Nissedal is located named after?',\n 'question_decomposition': [{'answer': 'Norway',\n                             'id': 269805,\n                             'paragraph_support_idx': 10,\n                             'question': 'Nissedal &gt;&gt; country'},\n                            {'answer': 'north',\n                             'id': 135710,\n                             'paragraph_support_idx': 6,\n                             'question': 'The #1 was named for whom?'}]}\n\n\nLine Example\n\n\nNone\n\n\n\n\nAnswerable/unanswerable lines\n\nunanswerable_lines = [line for line in lines if not line['answerable']]\nnum_unanswerable_lines = len(unanswerable_lines)\nprint(f'Number of unanswerable lines: {num_unanswerable_lines}')\n\nNumber of unanswerable lines: 494\n\n\n\nlines[1]\n\n{'id': '2hop__269805_135710',\n 'paragraphs': [{'idx': 0,\n   'title': 'Milton F. Pavlic',\n   'paragraph_text': 'Milton F. Pavlic (1909–1942) was a United States Navy officer killed in action during World War II for whom a U.S. Navy high-speed transport was named.',\n   'is_supporting': False},\n  {'idx': 1,\n   'title': 'Osmund Holm-Hansen',\n   'paragraph_text': 'Osmund Holm-Hansen (also known as Oz Holm-Hansen) is a Norwegian-born American scientist, for whom Mount Holm-Hansen, in Antarctica is named. A plant physiologist by training, from 1962 Holm-Hansen was the head of polar research at the Scripps Institution of Oceanography.',\n   'is_supporting': False},\n  {'idx': 2,\n   'title': 'Sapphire Princess',\n   'paragraph_text': '\"Sapphire Princess\" was built in Japan by Mitsubishi Heavy Industries, the second Princess Cruises ship to be built in a Japanese shipyard. Her only sister ship is \"Diamond Princess\", with whom she swapped names during construction.',\n   'is_supporting': False},\n  {'idx': 3,\n   'title': 'Lake Pontchartrain',\n   'paragraph_text': 'Lake Pontchartrain is named for Louis Phélypeaux, comte de Pontchartrain. He was the French Minister of the Marine, Chancellor, and Controller-General of Finances during the reign of France\\'s \"Sun King\", Louis XIV, for whom the colony of \"La Louisiane\" was named.',\n   'is_supporting': False},\n  {'idx': 4,\n   'title': 'Henry (Martian crater)',\n   'paragraph_text': 'Henry Crater is a large crater in the Arabia quadrangle of Mars, located at 10.9° north latitude and 23.3° east longitude. It is in diameter and was named after the brothers Paul Henry and Prosper Henry, both of whom were French telescope makers and astronomers.',\n   'is_supporting': False},\n  {'idx': 5,\n   'title': 'Where Dead Voices Gather',\n   'paragraph_text': 'Where Dead Voices Gather is a book by Nick Tosches. It is, in part, a biography of Emmett Miller, one of the last minstrel singers. Just as importantly, it depicts Tosches\\' search for information about Miller, about whom he initially wrote in his book \"Country: The Twisted Roots of Rock and Roll\". It is also a study of minstrelsy and its connection to American folk music, country music, the blues and ultimately, rock and roll. In that way, it is a companion volume to his other books of music journalism, \"Country\" and \"Unsung Heroes of Rock N\\' Roll\".',\n   'is_supporting': False},\n  {'idx': 6,\n   'title': 'Norway',\n   'paragraph_text': \"Norway has a total area of and a population of 5,312,300 (as of August 2018). The country shares a long eastern border with Sweden (1,619 km or 1,006\\xa0mi long). Norway is bordered by Finland and Russia to the north-east, and the Skagerrak strait to the south, with Denmark on the other side. Norway has an extensive coastline, facing the North Atlantic Ocean and the Barents Sea. The maritime influence also dominates Norway's climate with mild lowland temperatures on the sea coasts, whereas the interior, while colder, also is a lot milder than areas elsewhere in the world on such northerly latitudes. Even during polar night in the north, temperatures above freezing are commonplace on the coastline. The maritime influence brings high rainfall and snowfall to some areas of the country.\",\n   'is_supporting': True},\n  {'idx': 7,\n   'title': 'The Hireling Shepherd',\n   'paragraph_text': \"The Hireling Shepherd (1851) is a painting by the Pre-Raphaelite artist William Holman Hunt. It represents a shepherd neglecting his flock in favour of an attractive country girl to whom he shows a death's-head hawkmoth. The meaning of the image has been much debated.\",\n   'is_supporting': False},\n  {'idx': 8,\n   'title': 'Naissa Mosque',\n   'paragraph_text': 'Naissa Mosque is a mosque in Qardaha, along the Syrian coast. It was built in 1989 by architect Abdul Rahman Naassan, and funded by the mother of former president Hafez al-Assad, Naissa Assad—after whom the mosque was named. The state funeral of Hafez al-Assad was observed at the mosque.',\n   'is_supporting': False},\n  {'idx': 9,\n   'title': 'Franco-Prussian War',\n   'paragraph_text': 'The quick German victory over the French stunned neutral observers, many of whom had expected a French victory and most of whom had expected a long war. The strategic advantages possessed by the Germans were not appreciated outside Germany until after hostilities had ceased. Other countries quickly discerned the advantages given to the Germans by their military system, and adopted many of their innovations, particularly the General Staff, universal conscription and highly detailed mobilization systems.',\n   'is_supporting': False},\n  {'idx': 10,\n   'title': 'Tveitsund',\n   'paragraph_text': 'Tveitsund is a village in Nissedal municipality, Norway. The urban area Tveitsund, which consists of Tveitsund and Treungen, has a population of 361.',\n   'is_supporting': True},\n  {'idx': 11,\n   'title': 'John Francis Sheehan',\n   'paragraph_text': 'John Francis Sheehan (1910–1942) was a United States Navy sailor killed in action during World War II for whom a destroyer escort was named during the war.',\n   'is_supporting': False},\n  {'idx': 12,\n   'title': 'Holmes Summit',\n   'paragraph_text': 'Holmes Summit is a peak rising to , the highest elevation in the Read Mountains of the Shackleton Range in Antarctica. It was photographed from the air by the U.S. Navy in 1967 and was surveyed by the British Antarctic Survey in the period 1968–71. In association with the names of geologists grouped in this area, it was named by the UK Antarctic Place-Names Committee in 1971 after Professor Arthur Holmes, after whom the Holmes Hills in Palmer Land were also named.',\n   'is_supporting': False},\n  {'idx': 13,\n   'title': 'Yun Kōga',\n   'paragraph_text': ', better known by her pen name is a Japanese manga artist. She is married to fellow manga artist Tatsuneko, from whom he took the name of . She is a graduate of Mita Senior High School, Tokyo. She currently lives in Setagaya, Tokyo with her husband and daughter.',\n   'is_supporting': False},\n  {'idx': 14,\n   'title': 'The Book of Proper Names',\n   'paragraph_text': 'The Book of Proper Names () is a Belgian novel by Amélie Nothomb. It was first published in 2002. It is a romanticized account of the life of the singer RoBERT, whom Nothomb became acquainted with as an avid admirer of her songs.',\n   'is_supporting': False},\n  {'idx': 15,\n   'title': '653 Berenike',\n   'paragraph_text': '653 Berenike is a main-belt asteroid discovered on November 27, 1907, by Joel Hastings Metcalf at Taunton, Massachusetts. It is named after Berenice II of Egypt, after whom the constellation Coma Berenices is also named.',\n   'is_supporting': False},\n  {'idx': 16,\n   'title': '596 Scheila',\n   'paragraph_text': 'orbiting the Sun. It was discovered on 21 February 1906 by August Kopff from Heidelberg. Kopff named the asteroid after a female English student with whom he was acquainted.',\n   'is_supporting': False},\n  {'idx': 17,\n   'title': 'William M. Hobby',\n   'paragraph_text': 'William M. Hobby (1899–1942), was a United States Navy officer killed in action during World War II for whom a U.S. Navy ship was named.',\n   'is_supporting': False},\n  {'idx': 18,\n   'title': 'Alma Grace McDonough Health and Recreation Center',\n   'paragraph_text': 'The Alma Grace McDonough Health and Recreation Center is a 2,200 seat multipurpose arena and recreation facility on the campus of Wheeling Jesuit University in Wheeling, West Virginia. The building was constructed thanks to a gift from Alma Grace McDonough, whom the building is named after.',\n   'is_supporting': False},\n  {'idx': 19,\n   'title': 'Émile Bertrand',\n   'paragraph_text': 'Émile Bertrand (1844–1909) was a French mineralogist, in honour of whom bertrandite was named by Alexis Damour. He also gave his name to the \"Bertrand lens\" or phase telescope.',\n   'is_supporting': False}],\n 'question': 'What is the country where Nissedal is located named after?',\n 'question_decomposition': [{'id': 269805,\n   'question': 'Nissedal &gt;&gt; country',\n   'answer': 'Norway',\n   'paragraph_support_idx': 10},\n  {'id': 135710,\n   'question': 'The #1 was named for whom?',\n   'answer': 'north',\n   'paragraph_support_idx': 6}],\n 'answer': 'north',\n 'answer_aliases': ['North', 'N'],\n 'answerable': True}\n\n\n\n\nTokenizer\n\nimport tiktoken\n\ndisplay(Markdown('**Token models**'), tiktoken.model.MODEL_TO_ENCODING)\ntokenizer = tiktoken.encoding_for_model('gpt-3.5-turbo')\ndisplay(Markdown('**Tokenizer we are using**'), tokenizer)\n\nToken models\n\n\n{'gpt-4': 'cl100k_base',\n 'gpt-3.5-turbo': 'cl100k_base',\n 'gpt-3.5': 'cl100k_base',\n 'gpt-35-turbo': 'cl100k_base',\n 'davinci-002': 'cl100k_base',\n 'babbage-002': 'cl100k_base',\n 'text-embedding-ada-002': 'cl100k_base',\n 'text-embedding-3-small': 'cl100k_base',\n 'text-embedding-3-large': 'cl100k_base',\n 'text-davinci-003': 'p50k_base',\n 'text-davinci-002': 'p50k_base',\n 'text-davinci-001': 'r50k_base',\n 'text-curie-001': 'r50k_base',\n 'text-babbage-001': 'r50k_base',\n 'text-ada-001': 'r50k_base',\n 'davinci': 'r50k_base',\n 'curie': 'r50k_base',\n 'babbage': 'r50k_base',\n 'ada': 'r50k_base',\n 'code-davinci-002': 'p50k_base',\n 'code-davinci-001': 'p50k_base',\n 'code-cushman-002': 'p50k_base',\n 'code-cushman-001': 'p50k_base',\n 'davinci-codex': 'p50k_base',\n 'cushman-codex': 'p50k_base',\n 'text-davinci-edit-001': 'p50k_edit',\n 'code-davinci-edit-001': 'p50k_edit',\n 'text-similarity-davinci-001': 'r50k_base',\n 'text-similarity-curie-001': 'r50k_base',\n 'text-similarity-babbage-001': 'r50k_base',\n 'text-similarity-ada-001': 'r50k_base',\n 'text-search-davinci-doc-001': 'r50k_base',\n 'text-search-curie-doc-001': 'r50k_base',\n 'text-search-babbage-doc-001': 'r50k_base',\n 'text-search-ada-doc-001': 'r50k_base',\n 'code-search-babbage-code-001': 'r50k_base',\n 'code-search-ada-code-001': 'r50k_base',\n 'gpt2': 'gpt2',\n 'gpt-2': 'gpt2'}\n\n\nTokenizer we are using\n\n\n&lt;Encoding 'cl100k_base'&gt;\n\n\n\ntest_line = lines[1]\ntest_paragraphs = test_line['paragraphs']\n\ndisplay(Markdown('**Paragraph Example**'), test_paragraphs[0])\ntest_tokens = tokenizer.encode(test_paragraphs[0]['paragraph_text'])\ndisplay(Markdown('**Tokens**'), test_tokens)\ndisplay(Markdown('**Number of Tokens**'), len(test_tokens))\n\n\nParagraph Example\n\n\n{'idx': 0,\n 'title': 'Milton F. Pavlic',\n 'paragraph_text': 'Milton F. Pavlic (1909–1942) was a United States Navy officer killed in action during World War II for whom a U.S. Navy high-speed transport was named.',\n 'is_supporting': False}\n\n\nTokens\n\n\n[44,\n 16695,\n 435,\n 13,\n 43856,\n 416,\n 320,\n 7028,\n 24,\n 4235,\n 6393,\n 17,\n 8,\n 574,\n 264,\n 3723,\n 4273,\n 19574,\n 9640,\n 7577,\n 304,\n 1957,\n 2391,\n 4435,\n 5111,\n 8105,\n 369,\n 8884,\n 264,\n 549,\n 815,\n 13,\n 19574,\n 1579,\n 30699,\n 7710,\n 574,\n 7086,\n 13]\n\n\nNumber of Tokens\n\n\n39\n\n\n\nfor paragraph in test_paragraphs:\n    paragraph_text = paragraph['paragraph_text']\n    paragraph_tokens = tokenizer.encode(paragraph_text)\n    print(f'Number of tokens in paragraph: {len(paragraph_tokens)}')\n\nNumber of tokens in paragraph: 39\nNumber of tokens in paragraph: 68\nNumber of tokens in paragraph: 45\nNumber of tokens in paragraph: 64\nNumber of tokens in paragraph: 59\nNumber of tokens in paragraph: 131\nNumber of tokens in paragraph: 176\nNumber of tokens in paragraph: 59\nNumber of tokens in paragraph: 71\nNumber of tokens in paragraph: 86\nNumber of tokens in paragraph: 42\nNumber of tokens in paragraph: 36\nNumber of tokens in paragraph: 102\nNumber of tokens in paragraph: 61\nNumber of tokens in paragraph: 58\nNumber of tokens in paragraph: 57\nNumber of tokens in paragraph: 39\nNumber of tokens in paragraph: 35\nNumber of tokens in paragraph: 59\nNumber of tokens in paragraph: 48\n\n\n\npn.pane.JSON(lines[5])\n\n\n\n\n\n\nPrediction format\n\ndisplay(Markdown('**Examples of predictions**'))\nwith jsonlines.open(musique_dir + 'predictions/musique_ans_v1.0_dev_end2end_model_predictions.jsonl', 'r') as file:\n    for i in range(5):\n        display(pprint(file.read()))\n\nExamples of predictions\n\n\n{'id': '2hop__460946_294723',\n 'predicted_answer': 'Jennifer Garner',\n 'predicted_answerable': True,\n 'predicted_support_idxs': [0, 10]}\n{'id': '2hop__252311_366220',\n 'predicted_answer': 'Steven Spielberg',\n 'predicted_answerable': True,\n 'predicted_support_idxs': [10, 18]}\n{'id': '2hop__701895_752697',\n 'predicted_answer': 'Cypriot part was merged into the Bank of Cyprus '\n                     '(including insured deposits under 100,000 Euro) and the '\n                     \"'bad' part or legacy entity holds all the overseas \"\n                     'operations as well as uninsured deposits above 100,000 '\n                     'Euro, old shares and bonds. The uninsured depositors '\n                     'were subject to a bail-in and became the new '\n                     'shareholders of the legacy entity. As at May 2017, the '\n                     'legacy entity is one of the largest shareholders of Bank '\n                     'of Cyprus with 4.8% but does not hold a board seat. All '\n                     'the overseas operations, of the now defunct Cyprus '\n                     'Popular Bank, are also held by the legacy entity, until '\n                     'they are sold by the Special Administrator, at first Ms '\n                     'Andri Antoniadou, who ran the legacy entity for two '\n                     'years, from March 2013 until 3 March 2015. She tendered '\n                     'her resignation due to disagreements, with the Governor '\n                     'of the Central Bank of Cyprus and the Central Bank Board '\n                     'members, who amended the lawyers of the legacy entity, '\n                     'without consulting her. Veteran banker Chris [[PP]] The '\n                     'Ciudad Deportiva (\"Sports City\") is a sports complex in '\n                     'Nuevo Laredo, Mexico. It is home to the Tecolotes de '\n                     'Nuevo Laredo Mexican Baseball League team and the Toros '\n                     'de Nuevo Laredo Mexican professional basketball team '\n                     'from the Liga Nacional de Baloncesto Profesional. The '\n                     \"Ciudad Deportiva's Estadio Nuevo Laredo (baseball park) \"\n                     'can seat up to 12,000 fans at a baseball game and the '\n                     'Nuevo Laredo Multidisciplinary Gymnasium can seat 4,000 '\n                     'fans at a basketball game. [[PP]] Juan Carlos Espinoza '\n                     'Mercado (born 23 July 1987 in Machala) is an Ecuadorian '\n                     'professional football player who has played for '\n                     'Ecuadorian club Liga Deportiva Universitaria de Loja and '\n                     'in 2010 he joined Peruvian club Juan Aurich. [[PP]] '\n                     'Estadio Unión Tarma is a multi-use stadium in Tarma, '\n                     'Peru. It is currently used mostly for football matches '\n                     'and is the home stadium of Asociación Deportiva Tarma of '\n                     'the Copa Perú. The stadium holds 9,000 spectators. '\n                     '[[PP]] A Nigerian State is a federated political entity, '\n                     'which shares sovereignty with the Federal Government of '\n                     'Nigeria, There are 36 States in Nigeria, which are bound '\n                     'together by a federal agreement. There is also a '\n                     'territory called the Federal Capital Territory (FCT), '\n                     'which is not a state, but a territory, under the direct '\n                     'control of the Federal Government. The States are '\n                     'further divided into a total of 774 Local Government '\n                     'Areas. Under the Nigerian Constitution, states have the '\n                     'power to ratify constitutional amendments. [[PP]] Ofu '\n                     'Airport is a public airport located one mile (2 km) '\n                     'southeast of the village of Ofu on the island of Ofu in '\n                     'American Samoa, an unincorporated territory of the '\n                     'United States. This airport is publicly owned by '\n                     'Government of American Samoa. [[PP]] The Díaz '\n                     'administration made political decisions and took legal '\n                     'measures that allowed the elite throughout Mexico',\n 'predicted_answerable': True,\n 'predicted_support_idxs': [11, 16, 18]}\n{'id': '2hop__259228_793698',\n 'predicted_answer': 'Fairfield, Connecticut. Its main offices are located at '\n                     '30 Rockefeller Plaza at Rockefeller Center in New York '\n                     'City, known now as the Comcast Building. It was formerly '\n                     'known as the GE Building for the prominent GE logo on '\n                     \"the roof; NBC's headquarters and main studios are also \"\n                     'located in the building. Through its RCA subsidiary, it '\n                     'has been associated with the center since its '\n                     'construction in the 1930s. GE moved its corporate '\n                     'headquarters from the GE Building on Lexington Avenue to '\n                     'Fairfield in 1974. [[PP]] The lander is named after the '\n                     'Philae obelisk, which bears a bilingual inscription and '\n                     'was used along with the Rosetta Stone to decipher '\n                     'Egyptian hieroglyphs. \"Philae\" was monitored and '\n                     \"operated from DLR's Lander Control Center in Cologne\",\n 'predicted_answerable': True,\n 'predicted_support_idxs': [2, 10, 14]}\n{'id': '2hop__481349_302087',\n 'predicted_answer': 'Bombardier Inc. the former CRJ100 and CRJ200 series are '\n                     'no longer in production but still in active airline '\n                     'service, while the more recent CRJ700, CRJ900 and '\n                     'CRJ1000 series are in production and in service. [[PP]] '\n                     'Products offered through the Great Value brand are often '\n                     'claimed to be as good as national brand offerings, but '\n                     'are typically sold at a lower price because of lower '\n                     'marketing and advertising expense. As a house or store '\n                     'brand, the Great Value line does not consist of goods '\n                     'produced by Walmart, but is a labeling system for items '\n                     'manufactured and packaged by a number of agricultural '\n                     'and food corporations, such as ConAgra, Sara Lee which, '\n                     'in addition to releasing products under its own brands '\n                     'and exclusively for Walmart, also manufactures and '\n                     'brands foods for a variety of other chain stores. Often, '\n                     'this labeling system, to the dismay of consumers, does '\n                     'not list location of manufacture of the product. Wal - '\n                     'Mart contends that all Great Value products are produced '\n                     'in the United States. Otherwise, the country of origin '\n                     'would be listed. [[PP]] On June 11, 2006, the British '\n                     'tabloid The Mail on Sunday reported that iPods are '\n                     'mainly manufactured by workers who earn no more than '\n                     'US$50 per month and work 15-hour shifts. Apple '\n                     'investigated the case with independent auditors and '\n                     \"found that, while some of the plant's labour practices \"\n                     \"met Apple's Code of Conduct, others did not: employees \"\n                     'worked over 60 hours a week for 35% of the time, and '\n                     'worked more than six consecutive days for 25% of the '\n                     'time. [[PP]] The EMD E6 was a , A1A-A1A, passenger train '\n                     'locomotive manufactured by Electro-Motive Corporation, '\n                     'and its corporate successor, General Motors',\n 'predicted_answerable': True,\n 'predicted_support_idxs': [5, 10]}\n\n\nNone\n\n\nNone\n\n\nNone\n\n\nNone\n\n\nNone"
  }
]